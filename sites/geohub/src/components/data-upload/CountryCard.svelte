<script lang="ts">
  import type { Country } from '$lib/types'
  import { createEventDispatcher } from 'svelte'

  const dispatch = createEventDispatcher()

  export let country: Country
  export let isSelectable = true
  export let isSelected = false

  const handleSDGSelected = () => {
    if (!isSelectable) return
    isSelected = !isSelected
    dispatch('countrySelected', {
      country: country,
      isSelected: isSelected,
    })
  }

  const deselect = () => {
    isSelected = false
    dispatch('countrySelected', {
      country: country,
      isSelected: isSelected,
    })
  }

  const handleEnterKey = (e: KeyboardEvent) => {
    if (e.key === 'Enter') {
      // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-ignore
      e.target.click()
    }
  }
</script>

<div
  class="country-button card m-0 p-0 {isSelectable ? 'is-selectable' : ''}"
  on:click={handleSDGSelected}
  on:keydown={handleEnterKey}>
  <div class="card-content">
    <div class="media">
      <figure
        class={`country-flag image is-48x48 is-flex is-justify-content-center is-align-items-center`}
        data-testid="icon-figure">
        {#if country.iso_2}
          <span class="fi fi-{country.iso_2.toLowerCase()}" />
        {:else}
          <i class="no-flag fa-solid fa-flag fa-2xl" />
        {/if}
      </figure>
      {#if isSelectable && isSelected}
        <div
          class="is-size-8 selected"
          title="Colormap Selected">
          <i class="fas fa-check" />
        </div>
      {/if}
      {#if !isSelectable}
        <button
          class="delete is-small close-button"
          on:click={deselect} />
      {/if}
    </div>
    <div class="content is-size-7 columns is-gapless">
      <p class="column is-10">
        {country.country_name}
      </p>
    </div>
  </div>
</div>

<style lang="scss">
  @import '/node_modules/flag-icons/css/flag-icons.min.css';

  .country-button {
    position: relative;

    .card-content {
      padding: 5px;

      .media {
        margin: 0;

        .country-flag {
          width: fit-content;
          margin: auto;
        }

        .fi {
          width: 48px !important;
          line-height: 2em !important;
        }

        .no-flag {
          margin: 0 auto;
        }

        .close-button {
          position: absolute;
          right: 2px;
          top: 1.5px;
        }

        .selected {
          color: hsl(141, 53%, 53%);
          position: absolute;
          right: 2px;
          top: 1.5px;
        }
      }
    }

    .content {
      width: fit-content;
      margin: auto;
    }
  }

  .is-selectable {
    cursor: pointer;
  }
  .is-selectable:hover {
    padding: 0;
    border: 1px solid hsl(204, 86%, 53%);
  }
</style>
