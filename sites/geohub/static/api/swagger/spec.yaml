openapi: 3.0.0
info:
  title: GeoHub API specification
  version: '1.0'
  description: |
    This documentation describes GeoHub's endpoints specification.

    Our core API is `/api/datasets` which allows users to search GeoHub datasets freely. It returns the response as GeoJSON feature collection and looks like similar to STAC response. Once you received the datasets details, you can handle them with our tiling servers. All our datasets are cloud optimised either `COG (Cloud Optimised GeoTiff)` or `PMTiles`.

    ## Raster datasets
    You can use our dynamic rater tiling servers - [titiler](https://titiler.undpgeohub.org/) and [titiler-dev](https://titiler-dev.undpgeohub.org/)

    ## Vector datasets
    Generally, vector tiles can be handled with [maplibre-gl-js](https://maplibre.org/projects/maplibre-gl-js/). But if the dataset's URL starts with `pmtiles://`, you can use [PMTiles Javascript API](https://protomaps.com/docs/frontends/maplibre) to add new protocol to your maplibre.

    ## Community maps API
    You can also get style.json of saved map style through `/api/style` endpoints.

    ## Authentication
    Some endpoints (for `GET`, `POST`, `PUT`, `DELETE` apis) with a padlock icon are required to sign in prior to using them. GeoHub uses either Azure Active Directory or GitHub authentication with Auth.js package. Auth.js package provides the following endpoints to [sign in](/auth/signIn) / [sign out](auth/signout). Please sign in first before trying swagger. If you use these endpoints without signing in, the result from the server might be different.

    Or you can use `token` query param to access with a valid access token for `/api` endpoints which have a padlock icon in swagger. A token can be issued through `/api/token` endpoint after you sign in with SSO. Default expiry time of a token is an hour, if you need a token with longer expiry time, please contact to us.

    ## Issues
    Please feel free to report any issues on GitHub from [here](https://github.com/UNDP-Data/geohub/issues). Or if you have any questions, please create a thread in GitHub's [discussions](https://github.com/UNDP-Data/geohub/discussions) page.
  contact:
    email: jin.igarashi@undp.org
    url: 'https://geohub.data.undp.org'
  license:
    name: BSD-3-Clause license
    url: 'https://github.com/UNDP-Data/geohub/blob/develop/LICENSE'
servers:
  - url: /api
    description: GeoHub APIs
paths:
  /datasets:
    get:
      summary: Datasets search API
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeoJSONFeatureCollection'
      operationId: get-datasets
      description: |-
        This API returns the result as GeoJSON feature collection format and it contains links property at the bottom.

        The links will have the following patterns.

        - self = URL for the query itself
        - root = URL origin for this API
        - next = URL for next page
        - previous = URL for previous page

        You can use next or previous links to implement paging feature.

        Flexiblely to search by key/value of tags.

        {key}={value} e.g., sdg_goal=1 to filter where tag key is sdg_goal and value is 1. If multiple key/value are set, it will filter by OR operator. if you want to filter by SDG1 and 2, you can query like '&sdg_goal=1&sdg_goal=2'
      parameters:
        - schema:
            type: string
          in: query
          name: query
          description: 'free text to search in name, description'
        - schema:
            type: string
          in: query
          name: bbox
          description: 'you can filter the data by bounding box (minx, miny, maxx, maxy)'
        - schema:
            type: number
          in: query
          name: limit
          description: The number of datasets retrieved. default is 10
        - schema:
            type: string
          in: query
          name: offset
          description: Offset value for paging. default is 0
        - schema:
            type: string
          in: query
          name: extent
          description: Search by extent value
        - schema:
            type: string
          in: query
          name: granularity
          description: Search by granularity value
        - schema:
            type: string
          in: query
          name: keyword
          description: Search by keyword value
        - schema:
            type: string
            enum:
              - table
              - function
          in: query
          name: layertype
          description: Search by layertype of pg_tileserv
        - schema:
            type: string
          in: query
          name: resolution
          description: Search by resolution value
        - schema:
            type: string
            enum:
              - '1'
              - '2'
              - '3'
              - '4'
              - '5'
              - '6'
              - '7'
              - '8'
              - '9'
              - '10'
              - '11'
              - '12'
              - '13'
              - '14'
              - '15'
              - '16'
              - '17'
          in: query
          name: sdg_goal
          description: search by sdg_goal value
        - schema:
            type: string
          in: query
          name: sdg_target
          description: search by sdg_target value
        - schema:
            type: string
            enum:
              - earth-search
              - microsoft-pc
          in: query
          name: stac
          description: search by stac value
        - schema:
            type: string
          in: query
          name: theme
          description: search by theme value
        - schema:
            type: string
            enum:
              - pgtileserv
              - stac
          in: query
          name: type
          description: search by type value
        - schema:
            type: string
          in: query
          name: year
          description: search by year value
        - schema:
            type: boolean
            default: 'false'
          in: query
          name: staronly
          description: 'if true, only search for favourite datasets'
        - schema:
            type: string
            default: and
            enum:
              - and
              - or
          in: query
          name: queryoperator
          description: operator for query search. convert space to either 'and' or 'or'
        - schema:
            type: string
            default: and
            enum:
              - and
              - or
          in: query
          name: operator
          description: 'operator for tag search. '
        - schema:
            type: boolean
            default: 'false'
            enum:
              - 'true'
              - 'false'
          in: query
          name: mydata
          description: 'if true, only fetch datasets owned by login user'
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
    post:
      summary: Register a dataset feature to GeoHub
      operationId: post-datasets
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeoJSONFeature'
      description: |-
        Register a dataset feature to GeoHub. If the dataset is already registered, the endpoint is going to update the dataset.

        Steps to register a dataset through this endpoint

        1.Authenticate to GeoHub

        The endpoint requires to be authenticated. You can sign in to GeoHub through your browser if you use swagger. Otherwise, please use `/api/token` endpoint to generate an access token.

        2.Create body for registration.

        It is basically the same feature of `/api/datasets` endpoint required to pass to POST api. You need to fill all information properly to register a dataset. 

        The below JSON is the basic structure of Feature Object. `type` must be `Feature`, and you need to add coordinates at `geometry` property. Normally, BBOX is used for it.

        ```
        {
          "type": "Feature",
          "geometry": {
            "type": "Polygon",
            "coordinates": [
            ]
          },
          "properties": {
          }
        }
        ```

        In terms of `properties`, the below table shows which property is essential to register.

        | Property | Required | Description |
        |---|---|---|
        | `id` | Y | MD5 Hash key generated from url |
        | `url` | Y | URL of a blob. SAS Token for blob storage access is not needed. If PMTiles, `pmtiles://` protocol is required. |
        | `name` | Y | title of a dataset. |
        | `description` | Y | description of a dataset. Write it as details as possible. |
        | `is_raster` | Y | true: raster dataset, false: vector dataset |
        | `license` | Y | Open data license name |
        | `access_level` | Y | 1: Private, 2: Organization, 3: Public |
        | `createdat` | N | Not required for registration, but required for updating |
        | `created_user` | N | Not required for registration, but required for updating |
        | `updatedat` | N | Not required for registration |
        | `updated_user` | N | Not required for registration |
        | `tags` | Y | See next section for further details |
        | `no_stars` | N | Not required for registration |
        | `permission` | N | Not required for registration |
        | `is_star` | N | Not required for registration |
        | `links` | N | Not required for registration |


        3.Tag registrations

        Particularly, tags are important to identify a dataset. The below table gives you an overview of tags used in GeoHub.

        | key | required | description |
        |---|---|---|
        | `type` | Y | `azure` value is for COG/PMTiles dataset. `pgtileserv` value is needed for pg_tileserv layer. `stac` is required for STAC collection or catalog. |
        | `schema` | N | Only needed for `type=pgtileserv`. Schema name for a dataset|
        | `table ` | N | Only needed for `type=pgtileserv`. Table name for a dataset |
        | `layertype` | N | Only needed for `type=pgtileserv`. either `table` or `function` |
        | `id` | N | Only needed for `type=pgtileserv`. id of pg_tileserv layer |
        | `provider` | Y | at least a provider name is required. You can add many provider tag as you wish. |
        | `extent` | N | If it is global data, `Global` value can be added |
        | `continent` | N | If it is not global data, continent tag like `Africa` is recommended to be added. See `/api/continents` api for available values. |
        | `region` | N | If it is not global data, region tag like `Sub-Saharan Africa` is recommended to be added. See `/api/regions` api for available values. |
        | `country` | N | If it is not global data, country tag like `KEN` is recommended to be added. See `/api/countries` api for available values. You can add many country tag as you wish. |
        | `sdg_goal` | N | If a dataset is related to any SDGs, the number like `1` for poverty can be added. You can add many sdg_goal tag as you wish. |
        | `unit` | N | If raster dataset, unit tag is recommended to be added. |
        | `year` | N | If applicable, `year` tag can be added. |
        | `resolution` | N | If applicable, `resolution` tag can be added. |


        For STAC collection's registration, it is recommended to use STAC management tool in GeoHub. Tags required for STAC are not covered by the above table.

        For pg_tileserv registration/deletion, it is also recommended to use pg_tileserv layer management tool in GeoHub.

        The best way to know which tags are essential for a dataset is to search a dataset in GeoHub. The below is an example dataset URLs for each type of a dataset.

        - [Raster dataset (COG)](/api/datasets/241c5b17f396f114ad6f9063d07762b8)
        - [Vector dataset (PMTiles)](/api/datasets/196af310ffb45117cb4f091fa5d98705)
        - [Vector dataset (pg_tileserv)](/api/datasets/320cf4ffcf6414a68b428f14a5728053)
        - [STAC Collection (Catalog)](/api/datasets/351155bfc6f45c2ae47e7cbb4f439a47)
        - [STAC Catalog (Catalog)](/api/datasets/e696b278429ed1ee0579e6257df1ca59)
        - [STAC Collection (API)](/api/datasets/c47e79d248510ba2d397b76972eb8a83)

        4.Register a dataset with access token

        Once you have made all properties required for your dataset, you can use the following template command to register your dataset into the database.

        ```
        curl -X 'POST' \
          'https://geohub.data.undp.org/api/datasets?token={your generated token}' \
          -H 'accept: application/json' \
          -H 'Content-Type: application/json' \
          -d '{
          "type": "string",
          "geometry": {
            "type": "string",
            "coordinates": [
            ]
          },
          "properties": {
            "id": "string",
            "url": "string",
            "name": "string",
            "description": "string",
            "is_raster": true,
            "license": "string",
            "access_level": 0,
            "tags": [
              {
                "key": "type",
                "value": "azure"
              }
            ]
          }
        }'
        ```
      security:
        - Azure AD authentication: []
        - API access token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GeoJSONFeature'
      tags:
        - datasets
  '/datasets/style/{layer}/{type}':
    parameters:
      - $ref: '#/components/parameters/maplibre_layer_type'
      - $ref: '#/components/parameters/maplibre_layer_id'
    post:
      summary: Create default layer style for unregistered dataset
      operationId: post-datasets-style-layer-type
      responses:
        '200':
          description: OK
      description: 'This endpoint is to return the default layer style for the dataset which is not registered to the database yet. The response is equivalent to the `/datasets/{id}/style/{layer}/{type}` API. But DatasetFeature object should be in body of POST request.'
      parameters:
        - schema:
            type: string
          in: query
          name: colormap_name
          description: 'Option. If specified, use this colormap to create layer style'
        - schema:
            type: string
          in: query
          name: algorithm
          description: Option. Algorithm ID for raster
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                feature:
                  $ref: '#/components/schemas/GeoJSONFeature'
        description: Dataset feature object
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
  '/datasets/{id}':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
    get:
      summary: Get dataset feature by ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeoJSONFeature'
      operationId: get-datasets-id
      description: get dataset feature by dataset ID
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete dataset by ID
      operationId: delete-datasets-id
      responses:
        '200':
          description: OK
      description: Delete dataset feature by dataset ID. This endpoint is required to sign in.
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
  '/datasets/{id}/permission':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Dataset ID
    get:
      summary: Get user permission info for a dataset
      tags:
        - datasets
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatasetPermission'
      operationId: get-datasets-id-permission
      description: Get permission info for a dataset
      security:
        - Azure AD authentication: []
        - API access token: []
    post:
      summary: Register user permission for a dataset
      operationId: post-datasets-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatasetPermission'
      description: |
        Register user permission for a dataset

        - only users with owner/write/read permission can register.
        - users with write permission cannot register owner permission to a user.
        - users with read permission can register read permission to a user.
      tags:
        - datasets
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DatasetPermission'
        description: ''
      security:
        - Azure AD authentication: []
        - API access token: []
    put:
      summary: Update user permission for a dataset
      operationId: put-datasets-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatasetPermission'
      description: |-
        Update user permission for a dataset

        - signed user cannot update their own permission
        - only users with owner/write/read permission can update.
        - users with write permission cannot update owner permission to a user.
        - users with read permission cannot update owner/write permission to a user.
      security:
        - Azure AD authentication: []
        - API access token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DatasetPermission'
      tags:
        - datasets
    delete:
      summary: Delete user permission for a dataset
      operationId: delete-datasets-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatasetPermission'
      description: |-
        Delete user permission for a dataset

        - cannot delete signed in user themselves
        - only users with owner/write/read permission can delete.
        - users with write permission cannot delete owner.
        - users with read permission cannot delete owner/write
        - if only a user is registered, cannot delete user. at least a user needs to be registered
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - datasets
      parameters:
        - schema:
            type: string
          in: query
          name: user_email
          description: user email address
          required: true
  '/datasets/{id}/star':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
    post:
      summary: Register dataset to favourite
      operationId: post-datasets-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  dataset_id:
                    type: string
                  user_email:
                    type: string
                  savedat:
                    type: string
                  no_stars:
                    type: integer
                required:
                  - dataset_id
                  - user_email
                  - savedat
      description: |-
        Register dataset to favourite
        This API only can be used when user sign in.
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete star from dataset
      operationId: delete-datasets-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  dataset_id:
                    type: string
                  no_stars:
                    type: integer
      description: |-
        Delete star from dataset
        This API only can be used when user sign in.
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
  '/datasets/{id}/star/count':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
    get:
      summary: get star count for a dataset
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  dataset_id:
                    type: string
                  no_stars:
                    type: integer
      operationId: get-datasets-id-star-count
      description: get the number of stars for a dataset
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
  '/datasets/{id}/style/{layer}/{type}':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
      - $ref: '#/components/parameters/maplibre_layer_type'
      - $ref: '#/components/parameters/maplibre_layer_id'
    get:
      summary: Get default layer style for a dataset
      tags:
        - datasets
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetLayerStyle'
        '404':
          description: Not Found
        '':
          description: ''
          content:
            application/json:
              schema:
                type: object
                properties:
                  dataset_id:
                    type: string
                  layer_type:
                    type: string
                  source:
                    type: string
                    description: JSON object for maplibre source
      operationId: get-datasets-id-style
      description: |-
        This endpoint is to return the default layer style for specified dataset if the style infomation is registered in the database.

        This endpoint's response contains two variables which are `style.id={layer_id}` and `style.source={source_id}`. When you use this default style in maplibre, please generate unique layer ID and soruce ID, then replace them before adding layer to maplibre.

        If the style is not registered in the database yet, the endpoint will create style randomly.

        **This endpoint might be restricted by the access level of the dataset**
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: string
          in: query
          name: colormap_name
          description: 'Option. If specified, use this colormap to create layer style'
    post:
      summary: Register default layer style for a dataset
      operationId: post-datasets-id-style-type
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetLayerStyle'
      description: |-
        This endpoint is to register the default layer style for specified dataset.

        This endpoint will replace `style.id` to `style.id={layer_id}` and `style.source` to `style.source={source_id}`. When you use this default style in maplibre, please generate unique layer ID and soruce ID, then replace them before adding layer to maplibre.

        **This endpoint only can be used by the dataset owner or super user.**
      tags:
        - datasets
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DatasetLayerStyle'
            examples:
              Example for vector:
                value:
                  dataset_id: 8c4810867c50ee006b11abf19876a750
                  layer_id: drr.dynamic_subnational_hhr
                  layer_type: fill
                  source:
                    type: vector
                    url: 'https://dev.undpgeohub.org/api/vector/pgtileserv/tile.json?table=drr.dynamic_subnational_hhr&type=function'
                    tiles:
                      - 'https://pgtileserv.undpgeohub.org/drr.dynamic_subnational_hhr/{z}/{x}/{y}.pbf?params={"hdi_adjustment"%3A{"value"%3A5.4}%2C"working_age_pop_adjustment"%3A{"value"%3A-4.9}}'
                  style:
                    id: 6b45fc16-6e59-438c-ae7a-57f6dcc8b09c
                    type: fill
                    source: 8c4810867c50ee006b11abf19876a750
                    source-layer: drr.dynamic_subnational_hhr
                    minzoom: 0
                    layout:
                      visibility: visible
                    paint:
                      fill-color:
                        type: interval
                        property: heat_health_risk_index
                        stops:
                          - - 16.88
                            - 'rgba(158, 1, 66, 1)'
                          - - 29.78
                            - 'rgba(249, 142, 82, 1)'
                          - - 43.71
                            - 'rgba(255, 255, 191, 1)'
                          - - 58.52
                            - 'rgba(137, 208, 165, 1)'
                          - - 72.71
                            - 'rgba(94, 79, 162, 1)'
                        default: 'rgba(0,0,0,0)'
                      fill-outline-color:
                        property: heat_health_risk_index
                        type: interval
                        stops:
                          - - 16.88
                            - 'rgba(52, 0, 0, 1)'
                          - - 29.78
                            - 'rgba(108, 23, 0, 1)'
                          - - 43.71
                            - 'rgba(125, 127, 70, 1)'
                          - - 58.52
                            - 'rgba(5, 85, 50, 1)'
                          - - 72.71
                            - 'rgba(0, 0, 47, 1)'
                        default: 'rgba(0,0,0,0)'
                      fill-opacity: 1
                  colormap_name: spectral
                  classification_method: q
        description: ''
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete default layer style for a dataset
      operationId: delete-datasets-id-style-type
      responses:
        '204':
          description: No Content
      description: |-
        This endpoint is to update the default layer style for specified dataset

        **This endpoint only can be used by the dataset owner or super user.**
      tags:
        - datasets
      security:
        - Azure AD authentication: []
        - API access token: []
  '/datasets/{id}/preview/style.json':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
    get:
      summary: Get Maplibre style.json for preview map
      tags:
        - datasets
      responses: {}
      operationId: get-datasets-id-preview-style.json
      description: |-
        This endpoint is to create a style.json with default style for the dataset preview.

        If `type` is not specified, the layer type will be assumed by the geometry type of the layer.

        If `layer` is not specified, the first layer (if vector) or the first band (if raster) will be used.
      parameters:
        - $ref: '#/components/parameters/maplibre_layer_type_optional'
        - $ref: '#/components/parameters/maplibre_layer_id_optional'
  '/datasets/{id}/preview/auto/{width}x{height}.{format}':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Get a preview image for the dataset by using the default location
      tags:
        - datasets
      responses: {}
      operationId: get-datasets-id-preview-auto
      description: This endpoint is to create a preview image for the dataset. The default location saved in the dataset will be used automatically.
      parameters:
        - $ref: '#/components/parameters/maplibre_layer_id_optional'
        - $ref: '#/components/parameters/maplibre_layer_type_optional'
  '/datasets/{id}/preview/{bbox}/{width}x{height}.{format}':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
      - $ref: '#/components/parameters/bbox'
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Get a preview image for the dataset by using specific BBOX
      tags:
        - datasets
      responses: {}
      operationId: get-datasets-id-preview-bbox
      description: This endpoint is to create a preview image for the dataset by specifing the BBOX boundary
      parameters:
        - $ref: '#/components/parameters/maplibre_layer_id_optional'
        - $ref: '#/components/parameters/maplibre_layer_type_optional'
  '/datasets/{id}/preview/{lon},{lat},{zoom},{bearing},{pitch}/{width}x{height}.{format}':
    parameters:
      - $ref: '#/components/parameters/dataset_id'
      - $ref: '#/components/parameters/lon'
      - $ref: '#/components/parameters/lat'
      - $ref: '#/components/parameters/zoom'
      - $ref: '#/components/parameters/bearing'
      - $ref: '#/components/parameters/pitch'
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Get a preview image for the dataset with manually specified parameters
      tags:
        - datasets
      responses: {}
      operationId: get-datasets-id-preview-lon-lat-zoom-bearing-pitch
      description: This endpoint is to create a preview image for the dataset with manually specified parameters
      parameters:
        - $ref: '#/components/parameters/maplibre_layer_id_optional'
        - $ref: '#/components/parameters/maplibre_layer_type_optional'
  /datasets/ingesting:
    get:
      summary: Get status of ingesting datasets
      tags:
        - datasets
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                x-examples:
                  Example 1:
                    - raw:
                        name: Anthropogenic_Biomes_20230224163255.tif
                        url: 'https://undpgeohub.blob.core.windows.net/userdata/a85516c81c0b78d3e89d3f00099b8b15/raw/Anthropogenic_Biomes_20230224163255.tif?sv=2021-10-04&ss=b&srt=o&se=2023-02-24T19%3A58%3A12Z&sp=r&sig=bCEjmWyg2ggSLrF0%2FwNVVTujRjM7Wi8rb3b9zpVpNpU%3D'
                        contentLength: 832784
                        createdat: '2023-02-24T16:32:58.000Z'
                        updatedat: '2023-02-24T16:32:58.000Z'
                        error: 'https://undpgeohub.blob.core.windows.net/userdata/a85516c81c0b78d3e89d3f00099b8b15/raw/Anthropogenic_Biomes_20230224163255.tif.error?sv=2021-10-04&ss=b&srt=o&se=2023-02-24T19%3A58%3A12Z&sp=r&sig=bCEjmWyg2ggSLrF0%2FwNVVTujRjM7Wi8rb3b9zpVpNpU%3D'
                    - raw:
                        name: admin0_20230224161338.pmtiles
                        url: 'https://undpgeohub.blob.core.windows.net/userdata/a85516c81c0b78d3e89d3f00099b8b15/raw/admin0_20230224161338.pmtiles?sv=2021-10-04&ss=b&srt=o&se=2023-02-24T19%3A58%3A12Z&sp=r&sig=bCEjmWyg2ggSLrF0%2FwNVVTujRjM7Wi8rb3b9zpVpNpU%3D'
                        contentLength: 11813331
                        createdat: '2023-02-24T16:14:14.000Z'
                        updatedat: '2023-02-24T16:14:14.000Z'
                      datasets:
                        - name: admin0_20230224161338.pmtiles
                          url: 'https://undpgeohub.blob.core.windows.net/userdata/a85516c81c0b78d3e89d3f00099b8b15/datasets/admin0_20230224161338.pmtiles/admin0_20230224161338.pmtiles?sv=2021-10-04&ss=b&srt=o&se=2023-02-24T19%3A58%3A12Z&sp=r&sig=bCEjmWyg2ggSLrF0%2FwNVVTujRjM7Wi8rb3b9zpVpNpU%3D'
                          contentLength: 11813331
                          createdat: '2023-02-24T16:19:35.000Z'
                          updatedat: '2023-02-24T16:19:35.000Z'
                          processing: true
                items:
                  type: object
                  properties:
                    raw:
                      type: object
                      required:
                        - name
                        - url
                        - contentLength
                        - createdat
                        - updatedat
                      properties:
                        name:
                          type: string
                        url:
                          type: string
                        contentLength:
                          type: integer
                        createdat:
                          type: string
                        updatedat:
                          type: string
                        error:
                          type: string
                    datasets:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          url:
                            type: string
                          contentLength:
                            type: integer
                          createdat:
                            type: string
                          updatedat:
                            type: string
                          processing:
                            type: boolean
                        required:
                          - name
                          - url
                          - contentLength
                          - createdat
                          - updatedat
                          - processing
                  required:
                    - raw
              examples:
                Example:
                  value:
                    - raw:
                        name: string
                        url: string
                        contentLength: 0
                        createdat: string
                        updatedat: string
                        error: string
                      datasets:
                        - name: string
                          url: string
                          contentLength: 0
                          createdat: string
                          updatedat: string
                          processing: true
      operationId: get-datasets-ingesting
      description: |-
        This endpoint is going to scan data upload folder for login user to check the status of ingesting datasets.Authentication is required prior to using this API.

        URLs will be attached SAS token (1 hour expiry period)

        User's upload folder structure will be like this.

        - userdata
          - a85516c81c0b78d3e89d3f00099b8b15 (md5 hash key generated from email)
            - raw
              - aaa_yyyymmddhhmmss.tif - original data
              - aaa_yyyymmddhhmmss.tif.error - in case data processing failed. Logs for data processing should be contained in .error file 
            - datasets
              - aaa_yyyymmddhhmmss.tif - subfolder
                - aaa_yyyymmddhhmmss.tif - processed data
                - aaa_yyyymmddhhmmss.tif.ingesting - processing end, but unpublished
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: string
            default: createdat
            enum:
              - name
              - contentLength
              - createdat
              - updatedat
          in: query
          name: sortby
          description: Sorting column
        - schema:
            type: string
            enum:
              - asc
              - desc
            default: desc
          in: query
          name: sortorder
          description: Sorting order either 'asc' or 'desc'
  /datasets/stats:
    get:
      summary: Get statistics for published datasets
      tags:
        - datasets
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    stats:
                      type: string
                    title:
                      type: string
                    description:
                      type: string
              examples:
                Example:
                  value:
                    - stat: '4384'
                      title: Public datasets
                      description: The number of public datasets
                    - stat: '91'
                      title: Country datasets
                      description: The number of public datasets linked to at least a country
                    - stat: '4164'
                      title: Global datasets
                      description: The number of public global datasets
                    - stat: '4337'
                      title: SDG datasets
                      description: The number of public datasets linked to at least a SDG
                    - stat: '27'
                      title: Countries
                      description: The number of countries having GeoHub datasets
      operationId: get-datasets-stats
      description: This endpoint is to get statistics for published datasets
  /style/count:
    get:
      summary: Get total count of styles
      tags:
        - style
      responses: {}
      operationId: get-style-count
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                count:
                  type: integer
            examples:
              Example 1:
                value:
                  count: 6
  /style:
    get:
      summary: Style list API
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  styles:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        createdat:
                          type: string
                        name:
                          type: string
                        updatedat:
                          type: string
                        access_level:
                          type: integer
                          default: 1
                          description: '1: login user, 2: UNDP, 3: public'
                        created_user:
                          type: string
                        updated_user:
                          type: string
                        no_stars:
                          type: integer
                        is_star:
                          type: boolean
                        links:
                          type: array
                          items:
                            $ref: '#/components/schemas/Link'
                      required:
                        - id
                        - createdat
                        - name
                        - updatedat
                        - access_level
                        - links
                  links:
                    type: array
                    items:
                      $ref: '#/components/schemas/Link'
                  pages:
                    type: object
                    properties:
                      totalCount:
                        type: integer
                      totalPages:
                        type: integer
                      currentPage:
                        type: integer
                required:
                  - styles
                  - links
              examples:
                Example:
                  value:
                    styles:
                      - id: 201
                        name: Cross Blended Hypso with Shaded Relief and Water
                        access_level: 1
                        createdat: '2023-03-20T18:58:13.443Z'
                        created_user: jin.igarashi@undp.org
                        updatedat: '2023-03-20T18:58:13.443Z'
                        updated_user: null
                        no_stars: 5
                        is_star: true
                        links:
                          - rel: root
                            type: application/json
                            href: 'http://localhost:5173/api/style'
                          - rel: self
                            type: application/json
                            href: 'http://localhost:5173/api/style/201'
                          - rel: map
                            type: application/json
                            href: 'http://localhost:5173/map/201'
                          - rel: stylejson
                            type: application/json
                            href: 'http://localhost:5173/api/style/201.json'
                    links:
                      - rel: root
                        type: application/json
                        href: 'http://localhost:5173/api/style'
                      - rel: self
                        type: application/json
                        href: 'http://localhost:5173/api/style?limit=1'
                      - rel: next
                        type: application/json
                        href: 'http://localhost:5173/api/style?limit=1&offset=1'
                    pages:
                      totalCount: 9
                      totalPages: 9
                      currentPage: 1
      operationId: get-style
      description: Get the list of saved style from PostGIS database
      parameters:
        - schema:
            type: integer
          in: query
          name: limit
        - schema:
            type: integer
          in: query
          name: offset
        - schema:
            type: string
          in: query
          name: sortby
          description: 'sorting column and sorting order. e.g., ''updatedat, desc''. if asc or desc is skipped, asc will be used.'
        - schema:
            type: string
          in: query
          name: query
          description: text to search styles by name
        - schema:
            type: integer
            default: 1
            enum:
              - 1
              - 2
              - 3
          in: query
          name: accesslevel
          description: 'access Level published to 1: login user 2: UNDP 3: public'
        - schema:
            type: boolean
          in: query
          name: staronly
          description: 'if true, only search for favourite datasets'
      security:
        - Azure AD authentication: []
        - API access token: []
    post:
      summary: Style register API
      operationId: post-style
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  viewer:
                    type: string
                    description: URL for style sharing viewer
                  style:
                    type: string
                    description: style.json URL
                required:
                  - viewer
                  - style
      description: Save style.json to PostgreSQL database
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: name for style
                style:
                  type: object
                  description: style.json object
                layers:
                  type: array
                  description: $layerList object
                  items:
                    type: object
                access_level:
                  type: integer
                  enum:
                    - 1
                    - 2
                    - 3
                  description: '1: login user, 2: UNDP, 3: public'
              required:
                - name
                - style
                - layers
                - access_level
      tags:
        - style
      security:
        - Azure AD authentication: []
        - API access token: []
    put:
      summary: Style update API
      operationId: put-style
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  viewer:
                    type: string
                    description: URL for viewer
                  style:
                    type: string
                    description: style.json URL
                required:
                  - id
                  - viewer
                  - style
      description: Update style.json to PostgreSQL database
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: integer
                  description: style id to update
                name:
                  type: string
                  description: name for saved style
                styles:
                  type: object
                  description: style.json object
                layers:
                  type: array
                  description: $layerList object
                  items:
                    type: object
                access_level:
                  type: integer
                  description: '1: login user, 2: UNDP, 3: public'
              required:
                - id
                - name
                - styles
                - layers
                - access_level
      tags:
        - style
      security:
        - Azure AD authentication: []
        - API access token: []
  '/style/{id}':
    parameters:
      - schema:
          type: integer
        name: id
        in: path
        required: true
        description: style ID
    delete:
      summary: Style delete API
      operationId: delete-style-id
      responses:
        '204':
          description: No Content
      description: Delete style by ID
      tags:
        - style
      security:
        - Azure AD authentication: []
        - API access token: []
    get:
      summary: Style info API
      operationId: get-style-id
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  name:
                    type: string
                  style:
                    type: object
                  layers:
                    type: array
                    items:
                      type: object
                  createdat:
                    type: string
                  updatedat:
                    type: string
                  access_level:
                    type: integer
                    description: '1: login user, 2: UNDP, 3: public'
                  created_user:
                    type: string
                  updated_user:
                    type: string
                  is_star:
                    type: boolean
                  links:
                    type: array
                    items:
                      $ref: '#/components/schemas/Link'
                required:
                  - id
                  - name
                  - style
                  - layers
                  - createdat
                  - updatedat
                  - access_level
                  - links
      description: get style information by style id
      tags:
        - style
      security:
        - Azure AD authentication: []
        - API access token: []
  '/style/{id}.json':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: style ID
    get:
      summary: Style JSON api
      tags:
        - style
      responses:
        '200':
          description: style.json object
      operationId: get-style-id-.json
      description: get style.json by ID
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: boolean
            default: 'false'
          in: query
          name: exclude
          description: 'If true, exclude basemap layers from style.json'
  '/style/{id}/permission':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Style ID
    get:
      summary: Get user permission info for a style
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StylePermission'
      operationId: get-style-id-permission
      description: Get permission info for a style
      security:
        - Azure AD authentication: []
        - API access token: []
    post:
      summary: Register user permission for a style
      operationId: post-style-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StylePermission'
      description: |
        Register user permission for a style

        - only users with owner/write/read permission can register.
        - users with write permission cannot register owner permission to a user.
        - users with read permission can register read permission to a user.
      tags:
        - style
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StylePermission'
        description: ''
      security:
        - Azure AD authentication: []
        - API access token: []
    put:
      summary: Update user permission for a style
      operationId: put-style-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StylePermission'
      description: |-
        Update user permission for a style

        - signed user cannot update their own permission
        - only users with owner/write/read permission can update.
        - users with write permission cannot update owner permission to a user.
        - users with read permission cannot update owner/write permission to a user.
      security:
        - Azure AD authentication: []
        - API access token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StylePermission'
      tags:
        - style
    delete:
      summary: Delete user permission for a style
      operationId: delete-style-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StylePermission'
      description: |-
        Delete user permission for a style

        - cannot delete signed in user themselves
        - only users with owner/write/read permission can delete.
        - users with write permission cannot delete owner.
        - users with read permission cannot delete owner/write
        - if only a user is registered, cannot delete user. at least a user needs to be registered
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - style
      parameters:
        - schema:
            type: string
          in: query
          name: user_email
          description: user email address
          required: true
  '/style/{id}/star':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    post:
      summary: Register style to favourite
      operationId: post-style-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  style_id:
                    type: integer
                  no_stars:
                    type: integer
                required:
                  - style_id
                  - no_stars
      description: |-
        Register style to favourite
        This API only can be used when user sign in.
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - style
    delete:
      summary: Delete style from favourite
      operationId: delete-style-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  style_id:
                    type: integer
                  no_stars:
                    type: integer
                required:
                  - style_id
                  - no_stars
      description: |-
        Delete style from favourite
        This API only can be used when user sign in.
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - style
  '/style/{id}/star/count':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
    get:
      summary: Get star count for a style
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  style_id:
                    type: integer
                  no_stars:
                    type: integer
                required:
                  - style_id
                  - no_stars
      operationId: get-style-id-star-count
      description: get the number of stars for a dataset
      security:
        - Azure AD authentication: []
        - API access token: []
  '/style/{id}/static/auto/{width}x{height}.{format}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: style id
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Static image with default location
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/octet-stream:
              schema:
                type: object
                properties: {}
      operationId: get-style-id-static-auto-width-x-height-.png
      description: Get static image with default position of style.json
      parameters:
        - $ref: '#/components/parameters/ratio'
  '/style/{id}/static/{bbox}/{width}x{height}.{format}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: style ID
      - $ref: '#/components/parameters/bbox'
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Static image by BBOX
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/octet-stream:
              schema:
                type: object
                properties: {}
        '':
          description: ''
      operationId: get-style-id-static-bbox-width-x-height-.png
      description: Get static image by specified BBOX
      parameters:
        - $ref: '#/components/parameters/ratio'
  '/style/{id}/static/{lon},{lat},{zoom},{bearing},{pitch}/{width}x{height}.{format}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: style id
      - $ref: '#/components/parameters/lon'
      - $ref: '#/components/parameters/lat'
      - $ref: '#/components/parameters/zoom'
      - $ref: '#/components/parameters/bearing'
      - $ref: '#/components/parameters/pitch'
      - $ref: '#/components/parameters/width'
      - $ref: '#/components/parameters/height'
      - $ref: '#/components/parameters/format'
    get:
      summary: Static image by center and zoom
      tags:
        - style
      responses:
        '200':
          description: OK
          content:
            application/octet-stream:
              schema:
                type: object
                properties: {}
      operationId: 'get-style-id-static-lon-,-lat-,-zoom-,-bearing-,-pitch-width-x-height-.png'
      description: 'get static image by center and zoom, and bearing and pitch optionally'
      parameters:
        - $ref: '#/components/parameters/ratio'
  '/style/{id}/legend':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Style ID
    get:
      summary: Create legend from style
      tags:
        - style
      responses:
        '200':
          description: |
            `legend` property is a SVG string for legend image. If you want to generate your own legend, get the original values  from `raw` property.
            <br><br>
            `shape` property is only for vector layer. This have to replace the variables before using it. The variables are as follows:

            - `{size}`: size of SVG shape icon
            - `{style}`: If it is symbol layer, apply color by using filter.
            - `{color}`: If it is vector layer except symbol, change color by replacing this variable.
            <br><br>
            `colors`, `values`, `min`, `max`, `unit` might be missing depending on the type of legend and layer.
          content:
            application/json:
              schema:
                type: array
                items:
                  x-stoplight:
                    id: jy16vz8agudag
                  type: object
                  properties:
                    id:
                      type: string
                      x-stoplight:
                        id: mrg5h3paq7j5z
                      description: Layer ID
                    name:
                      type: string
                      x-stoplight:
                        id: 4ahsoq7p60a17
                      description: Layer title
                    legend:
                      type: string
                      x-stoplight:
                        id: 7f57g5ghea4kk
                      description: SVG string or preview URL of titiler.
                    raw:
                      type: object
                      x-stoplight:
                        id: bfx29tgsjicou
                      description: Original raw data for legend.
                      properties:
                        min:
                          type: number
                          x-stoplight:
                            id: rh9o806a2jy5w
                          description: 'Minimum value to be shown in legend. '
                        max:
                          type: number
                          x-stoplight:
                            id: 9hd5lb7vhgf25
                          description: 'Maximum value to be shown in legend. '
                        unit:
                          type: string
                          x-stoplight:
                            id: d2s9bzhr88av4
                          description: 'Unit value to be shown in legend. For vector, it iscolumn name selected.'
                        colors:
                          type: array
                          x-stoplight:
                            id: 3ypt3edsi4mtr
                          description: colors. array of rgba numeric values or hex
                          items:
                            x-stoplight:
                              id: 16xtqz2m6tfs5
                            type:
                              - array
                              - string
                            nullable: true
                            items:
                              x-stoplight:
                                id: idavfuxwnyt9m
                              type: number
                        values:
                          type: array
                          x-stoplight:
                            id: rcyvu2qumloae
                          description: values in array of string or number.
                          items:
                            x-stoplight:
                              id: nw1mph9e23cxi
                            type:
                              - number
                              - string
                        shape:
                          type: string
                          x-stoplight:
                            id: nc26tkxw7x9tj
                          description: SVG for base shape. Some variables have to be replaced before using.
                  required:
                    - id
                    - name
                    - legend
              examples:
                Raster Example:
                  value:
                    - id: 314ed0ee-10ee-4c68-8bec-cda0467965b6
                      name: 'Digital Elevation Model (DEM) 10m resolution, Rwanda'
                      legend: 'https://titiler-dev.undpgeohub.org/cog/preview?url=https%3A%2F%2Fundpgeohub.blob.core.windows.net%2Fuserdata%2Fa85516c81c0b78d3e89d3f00099b8b15%2Fdatasets%2FDem_Rwanda_10m_allt_20230921150153.tif%2FDem_Rwanda_10m_allt_20230921150153_band1.tif%3Fc3Y9MjAyNC0wOC0wNCZzcz1iJnNydD1vJnNlPTIwMjUtMDgtMTlUMTYlM0ExMyUzQTA2WiZzcD1yJnNpZz02RXMzUVFHRmNIb2glMkZ0S1Qwdng1YWE2ejhYc2pzemVXRHVZWkN5SXYwZmMlM0Q%3D&algorithm=hillshade&algorithm_params=%7B%22azimuth%22%3A57%2C%22angle_altitude%22%3A23.8%2C%22buffer%22%3A3%7D&height=64&width=64'
                    - id: 068bf5c9-8df8-4523-9632-638686be7a5b
                      name: Libya Floods - 34/120200213132/10500100363D0900 - visual
                      legend: 'https://titiler-dev.undpgeohub.org/cog/preview?url=https%3A%2F%2Fmaxar-opendata.s3.amazonaws.com%2Fevents%2FLibya-Floods-Sept-2023%2Fard%2F34%2F120200213132%2F2023-09-13%2F10500100363D0900-visual.tif&height=64&width=64'
                    - id: d070e328-7b5a-4499-8509-3867eb6f4df0
                      name: Anthropogenic Biomes
                      legend: '<svg width=''100%'' height=''630'' xmlns=''http://www.w3.org/2000/svg''><rect x=''10'' y=''10'' width=''20'' height=''20'' fill=''rgb(166,206,227)''/>  <text x=''40'' y=''25'' font-family=''ProximaNova'' font-size=''14''>Urban</text><rect x=''10'' y=''32'' width=''20'' height=''20'' fill=''rgb(114,164,203)''/>  <text x=''40'' y=''47'' font-family=''ProximaNova'' font-size=''14''>Dense settlements</text><rect x=''10'' y=''54'' width=''20'' height=''20'' fill=''rgb(64,134,176)''/>  <text x=''40'' y=''69'' font-family=''ProximaNova'' font-size=''14''>Rice villages</text><rect x=''10'' y=''76'' width=''20'' height=''20'' fill=''rgb(145,193,154)''/>  <text x=''40'' y=''91'' font-family=''ProximaNova'' font-size=''14''>Irrigated villages</text><rect x=''10'' y=''98'' width=''20'' height=''20'' fill=''rgb(161,212,125)''/>  <text x=''40'' y=''113'' font-family=''ProximaNova'' font-size=''14''>Cropped and pastoral villages</text><rect x=''10'' y=''120'' width=''20'' height=''20'' fill=''rgb(99,178,79)''/>  <text x=''40'' y=''135'' font-family=''ProximaNova'' font-size=''14''>Pastoral villages</text><rect x=''10'' y=''142'' width=''20'' height=''20'' fill=''rgb(144,158,92)''/>  <text x=''40'' y=''157'' font-family=''ProximaNova'' font-size=''14''>Rainfed villages</text><rect x=''10'' y=''164'' width=''20'' height=''20'' fill=''rgb(232,155,142)''/>  <text x=''40'' y=''179'' font-family=''ProximaNova'' font-size=''14''>Rainfed mosaic villages</text><rect x=''10'' y=''186'' width=''20'' height=''20'' fill=''rgb(242,120,120)''/>  <text x=''40'' y=''201'' font-family=''ProximaNova'' font-size=''14''>Residential irrigated cropland</text><rect x=''10'' y=''208'' width=''20'' height=''20'' fill=''rgb(228,43,44)''/>  <text x=''40'' y=''223'' font-family=''ProximaNova'' font-size=''14''>Residential rainfed mosaic</text><rect x=''10'' y=''230'' width=''20'' height=''20'' fill=''rgb(240,136,81)''/>  <text x=''40'' y=''245'' font-family=''ProximaNova'' font-size=''14''>Populated irrigated cropland</text><rect x=''10'' y=''252'' width=''20'' height=''20'' fill=''rgb(253,188,108)''/>  <text x=''40'' y=''267'' font-family=''ProximaNova'' font-size=''14''>Populated rainfed cropland</text><rect x=''10'' y=''274'' width=''20'' height=''20'' fill=''rgb(254,156,70)''/>  <text x=''40'' y=''289'' font-family=''ProximaNova'' font-size=''14''>Remote cropland</text><rect x=''10'' y=''296'' width=''20'' height=''20'' fill=''rgb(248,136,83)''/>  <text x=''40'' y=''311'' font-family=''ProximaNova'' font-size=''14''>Residential rangelands</text><rect x=''10'' y=''318'' width=''20'' height=''20'' fill=''rgb(219,164,179)''/>  <text x=''40'' y=''333'' font-family=''ProximaNova'' font-size=''14''>Populated rangelands</text><rect x=''10'' y=''340'' width=''20'' height=''20'' fill=''rgb(183,157,201)''/>  <text x=''40'' y=''355'' font-family=''ProximaNova'' font-size=''14''>Remote rangelands</text><rect x=''10'' y=''362'' width=''20'' height=''20'' fill=''rgb(131,97,168)''/>  <text x=''40'' y=''377'' font-family=''ProximaNova'' font-size=''14''>Populated forests</text><rect x=''10'' y=''384'' width=''20'' height=''20'' fill=''rgb(173,159,154)''/>  <text x=''40'' y=''399'' font-family=''ProximaNova'' font-size=''14''>Remote forests</text><rect x=''10'' y=''406'' width=''20'' height=''20'' fill=''rgb(244,243,153)''/>  <text x=''40'' y=''421'' font-family=''ProximaNova'' font-size=''14''>Wild forests</text><rect x=''10'' y=''428'' width=''20'' height=''20'' fill=''rgb(223,198,117)''/>  <text x=''40'' y=''443'' font-family=''ProximaNova'' font-size=''14''>Sparse trees</text><rect x=''10'' y=''450'' width=''20'' height=''20'' fill=''rgb(177,89,40)''/>  <text x=''40'' y=''465'' font-family=''ProximaNova'' font-size=''14''>Barren</text></svg>'
                    - id: 98dfef96-2c74-46e2-bcad-1744bb8c02e7
                      name: 'Digital Elevation Model (DEM) 10m resolution, Rwanda'
                      legend: '<svg width=''100%'' height=''70'' xmlns=''http://www.w3.org/2000/svg''>  <defs>  <linearGradient id=''grad1'' x1=''0%'' y1=''0%'' x2=''100%'' y2=''0%''><stop offset=''19%'' style=''stop-color:#543005;stop-opacity:1'' />,<stop offset=''38%'' style=''stop-color:#d0a55e;stop-opacity:1'' />,<stop offset=''57%'' style=''stop-color:#f5f5f5;stop-opacity:1'' />,<stop offset=''76%'' style=''stop-color:#62b4aa;stop-opacity:1'' />,<stop offset=''95%'' style=''stop-color:#003c30;stop-opacity:1'' /></linearGradient>  </defs>  <text x=''0'' y=''15'' font-family=''ProximaNova'' font-size=''12'' fill=''#000000''>m</text>  <rect y=''20'' width=''100%'' height=''28'' fill=''url(#grad1)'' />    <text x=''0'' y=''65'' font-family=''ProximaNova'' font-size=''12'' fill=''#000000''>100</text>  <text x=''100%'' y=''65'' font-family=''ProximaNova'' font-size=''12'' fill=''#000000'' text-anchor=''end''>4123</text></svg>'
                    - id: 23e5f29c-c929-4f96-9458-6b835b8a1f3d
                      name: 'Digital Elevation Model (DEM) 10m resolution, Rwanda'
                      legend: '<svg width=''100%'' height=''150'' xmlns=''http://www.w3.org/2000/svg''><text x=''10'' y=''15'' font-family=''ProximaNova'' font-size=''12'' fill=''#000000''>m</text><rect x=''10'' y=''25'' width=''20'' height=''20'' fill=''rgb(103,0,31)''/>  <text x=''40'' y=''40'' font-family=''ProximaNova'' font-size=''14''>958 - 1480.06</text><rect x=''10'' y=''47'' width=''20'' height=''20'' fill=''rgb(229,135,107)''/>  <text x=''40'' y=''62'' font-family=''ProximaNova'' font-size=''14''>1480.06 - 2063.96</text><rect x=''10'' y=''69'' width=''20'' height=''20'' fill=''rgb(255,255,255)''/>  <text x=''40'' y=''84'' font-family=''ProximaNova'' font-size=''14''>2063.96 - 2718.79</text><rect x=''10'' y=''91'' width=''20'' height=''20'' fill=''rgb(163,163,163)''/>  <text x=''40'' y=''106'' font-family=''ProximaNova'' font-size=''14''>2718.79 - 3404.31</text><rect x=''10'' y=''113'' width=''20'' height=''20'' fill=''rgb(26,26,26)''/>  <text x=''40'' y=''128'' font-family=''ProximaNova'' font-size=''14''>3404.31 - 4123.01</text></svg>'
      operationId: get-style-id-legend.-format
      description: |-
        Create a legend in JSON format from style.

        Legend property in the response may vary depending on the type of the layer and settings.

        - Raster
          - RGB layer: return titiler's preview URL
          - algorithm layer: return titiler's preview URL
          - linear legend: return SVG string
          - categoriesed legend: return SVG string
          - unique values legend: return SVG string
        - Vector:
          - Simple legend
          - categoriesed legend
          - unique values legend
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: boolean
          in: query
          name: debug
          description: 'If true, return `raw` property, Default is false'
  /stac:
    get:
      summary: get supported STAC API/Catalog list
      tags:
        - stac
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/stac'
      operationId: get-stac
      description: get supported STAC API/Catalog List
      parameters:
        - schema:
            type: string
            enum:
              - api
              - catalog
          in: query
          name: type
          description: STAC type either 'api' or 'catalog'
    post:
      summary: Register STAC catalog/api
      operationId: post-stac
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/stac'
      tags:
        - stac
      description: |-
        **ONLY ALLOW SUPERUSER TO USE THIS API**

        Register STAC catalog/api
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/stac'
        description: ''
      security:
        - Azure AD authentication: []
        - API access token: []
  '/stac/{id}':
    get:
      summary: get STAC API/Catalog info by ID
      operationId: get-stac-type
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/stac'
      description: get STAC API/Catalog info by ID
      tags:
        - stac
    put:
      summary: Update STAC API/Catalog
      operationId: put-stac-type
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/stac'
      tags:
        - stac
      description: |-
        **ONLY ALLOW SUPERUSER TO USE THIS API**

        Update STAC API/Catalog
      security:
        - Azure AD authentication: []
        - API access token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/stac'
    delete:
      summary: Delete STAC API/Catalog from GeoHub
      operationId: delete-stac-type
      responses:
        '200':
          description: OK
        '404':
          description: Not Found
      tags:
        - stac
      description: |-
        **ONLY ALLOW SUPERUSER TO USE THIS API**

        Delete a STAC a API/Catalog from GeoHub
      security:
        - Azure AD authentication: []
        - API access token: []
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: STAC server ID
  '/stac/{id}/{collection}/{...item}/{asset}':
    parameters:
      - schema:
          type: string
          enum:
            - microsoft-pc
            - earth-search
        name: id
        in: path
        required: true
        description: STAC server ID
      - schema:
          type: string
          example: sentinel-2-l2a
        name: collection
        in: path
        required: true
        description: STAC collection ID
      - schema:
          example: S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454
        name: ...item
        in: path
        required: true
        description: 'STAC item ID. To merge items as mosaic, you can put multiple item IDs by separating slash'
      - schema:
          type: string
          example: visual
        name: asset
        in: path
        required: true
        description: STAC Asset name for the item you want to use
    get:
      summary: Get STAC item information for GeoHub
      tags:
        - stac
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GeoJSONFeature'
      operationId: get-stac-type-collection-...item-asset
      description: |-
        This endpoint is to generate GeoJSON Feature object of user selected STAC items with all necessary information to be rendered in GeoHub.

        For instance, the following example URL is to request the server to return the GeoJSON Feature object for only a single item COG (`S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454`) from `sentinel-2-l2a` in Miscrosoft Planetary Computer.

        /api/stac/microsoft-pc/sentinel-2-l2a/S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454/visual

        If user want to merge several items to a mosaic, you can simply list item IDs in `...item` section by using slash as follows.

        /api/stac/microsoft-pc/sentinel-2-l2a/S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454/S2A_MSIL2A_20231010T203931_R028_T05LLC_20231010T233519/visual

        This mean the server create mosaicjson for item ID `S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454` and `S2A_MSIL2A_20231010T203931_R028_T05LLC_20231010T233519` for the client.

        For STAC datasets, the following tags will be included in the object.

        - type=`stac`
        - stacType=`cog` or `mosaicjson`
        - stac=stac ID. either `microsoft-pc` or `earth-search`
        - collection=collection ID
        - item=Item ID. There might be multiple tags for item
        - asset=asset name for item
        - provider=data provider name. There might be multiple tags for this.
  '/stac/style/{id}/{collection}/{...item}/{asset}':
    parameters:
      - schema:
          type: string
          enum:
            - microsoft-pc
            - earth-search
        name: id
        in: path
        required: true
        description: STAC server ID
      - schema:
          type: string
          example: sentinel-2-l2a
        name: collection
        in: path
        required: true
        description: STAC collection ID
      - schema:
          example: S2A_MSIL2A_20231010T203931_R028_T05LMC_20231010T233454
        name: ...item
        in: path
        required: true
        description: 'STAC item ID. To merge items as mosaic, you can put multiple item IDs by separating slash'
      - schema:
          type: string
          example: visual
        name: asset
        in: path
        required: true
        description: STAC Asset name for the item you want to use
    get:
      summary: Get default layer style for STAC item
      tags:
        - stac
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetLayerStyle'
      operationId: get-stac-type-collection-...item-asset
      description: |-
        This endpoint is to generate default layer style of user selected STAC items with all necessary information to be rendered in GeoHub.

        The response from this endpoint can be compatible with `/api/datasets/{id}/style/{layer}/{type}` endpoint.
      parameters:
        - schema:
            type: string
          in: query
          name: colormap_name
          description: 'Option. If specified, use this colormap to create layer style'
  '/stac/style/{id}/{collection}/{...item}/products':
    parameters:
      - schema:
          type: string
          enum:
            - microsoft-pc
            - earth-search
        name: id
        in: path
        required: true
        description: STAC server ID
      - schema:
          type: string
          example: sentinel-2-l2a
        name: collection
        in: path
        required: true
        description: STAC collection ID
      - schema:
          example: S2A_37MCU_20230925_0_L2A
        name: ...item
        in: path
        required: true
        description: 'STAC item ID. To merge items as mosaic, you can put multiple item IDs by separating slash'
    post:
      summary: Get layer style for STAC product passed in URL.
      tags:
        - stac
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StacProduct'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetLayerStyle'
      security:
        - Azure AD authentication: []
        - API access token: []
  '/stac/catalog/{id}/item':
    parameters:
      - schema:
          type: string
          enum:
            - maxar-opendata
            - capella-open-data
            - jaxa
            - nz-imagery
        name: id
        in: path
        required: true
        description: STAC server ID
    get:
      summary: Get STAC catalog item information for GeoHub
      tags:
        - stac
      responses: {}
      operationId: get-stac-catalog-id-item
      parameters:
        - schema:
            type: string
            example: 'https://maxar-opendata.s3.amazonaws.com/events/southafrica-flooding22/ard/36/213131032130/2022-04-20/105001002B445D00.json'
          in: query
          name: url
          required: true
          description: URL for STAC item.
        - schema:
            type: string
            example: visual
          in: query
          name: asset
          description: Asset name selected
          required: true
        - schema:
            type: string
            example: 'https://maxar-opendata.s3.amazonaws.com/events/southafrica-flooding22/collection.json'
          in: query
          name: collection
          description: 'URL for top-level collection. STAC catalog has nested structure and may have multiple collections until reaching item level. To create more comprehensive information for GeoHub, it required a URL for top-level collection.'
          required: true
      description: |-
        This endpoint is to create a feature JSON object for selected STAC item asset. This endpoint only can work for catalog type of STAC. STAC API item should use other endpoint of `/stac/{type}/{collection}/{...item}/{asset}.

        If multiple `url`s are specified, the endpoint will create a mosaicjson feature.
  /tags:
    get:
      summary: Tag search API
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
              examples:
                Example for tags?key=extent:
                  value:
                    extent:
                      - key: extent
                        value: Afghanistan
                        count: 2
                      - key: extent
                        value: Africa
                        count: 5
                      - key: extent
                        value: America
                        count: 1
                      - key: extent
                        value: Asia
                        count: 5
                      - key: extent
                        value: Burundi
                        count: 3
                      - key: extent
                        value: Cambodia
                        count: 2
                      - key: extent
                        value: Conflict areas
                        count: 1
                      - key: extent
                        value: Ethiopia
                        count: 3
                      - key: extent
                        value: EU
                        count: 3
                      - key: extent
                        value: Europe
                        count: 9
                      - key: extent
                        value: Ghana
                        count: 2
                      - key: extent
                        value: Global
                        count: 3845
                      - key: extent
                        value: Greenland and Antarctica
                        count: 1
                      - key: extent
                        value: India
                        count: 2
                      - key: extent
                        value: Kenya
                        count: 10
                      - key: extent
                        value: Madagascar
                        count: 2
                      - key: extent
                        value: Malawi
                        count: 4
                      - key: extent
                        value: Mali
                        count: 2
                      - key: extent
                        value: Mozambique
                        count: 2
                      - key: extent
                        value: Nepal
                        count: 2
                      - key: extent
                        value: Nigeria
                        count: 12
                      - key: extent
                        value: North America
                        count: 1
                      - key: extent
                        value: Oceania
                        count: 1
                      - key: extent
                        value: OECD
                        count: 7
                      - key: extent
                        value: Pakistan
                        count: 6
                      - key: extent
                        value: Rwanda
                        count: 6
                      - key: extent
                        value: South America
                        count: 1
                      - key: extent
                        value: SouthEast Asia
                        count: 2
                      - key: extent
                        value: Tanzania
                        count: 8
                      - key: extent
                        value: Uganda
                        count: 10
                      - key: extent
                        value: West Africa
                        count: 1
                      - key: extent
                        value: Zambia
                        count: 2
      operationId: get-tags
      description: 'This API can return the list of available tags. If you simply query by /tags, it returns all tags. You can also filter a key value to list available tags.'
      parameters:
        - schema:
            type: string
            enum:
              - extent
              - granularity
              - keyword
              - layertype
              - resolution
              - schema
              - sdg_goal
              - sdg_target
              - stac
              - theme
              - type
              - year
          in: query
          name: key
          description: Optional parameter to filter by key
      tags:
        - tags
  /vector/statistics:
    get:
      summary: Vector tile statistics API
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  layer:
                    type: string
                  geometry:
                    type: string
                  count:
                    type: number
                  attributeCount:
                    type: number
                  attributes:
                    type: array
                    items:
                      type: object
                      properties:
                        attribute:
                          type: string
                        type:
                          type: string
                        count:
                          type: number
                        min:
                          type: number
                        max:
                          type: number
                        mean:
                          type: number
                        median:
                          type: number
                        std:
                          type: number
                        histogram:
                          type: object
                          properties:
                            count:
                              type: array
                              items:
                                type: number
                            bins:
                              type: array
                              items:
                                type: number
              examples:
                Example for zambia.poverty:
                  value:
                    layer: zambia.poverty
                    geometry: Polygon
                    count: 145
                    attributeCount: 7
                    attributes:
                      - attribute: poverty
                        type: number
                        count: 145
                        min: 0.1
                        max: 0.96
                        mean: 0.6919310344827585
                        median: 0.78
                        std: 0.21315518783181625
                        histogram:
                          count:
                            - 9
                            - 19
                            - 10
                            - 36
                            - 71
                          bins:
                            - 0.1
                            - 0.272
                            - 0.444
                            - 0.616
                            - 0.788
                            - 0.96
                Example for zambia.poverty_selector:
                  value:
                    layer: zambia.poverty_selector
                    geometry: Polygon
                    count: 5
                    attributeCount: 1
                    attributes:
                      - attribute: district
                        type: string
                        count: 5
                        values:
                          - Chilubi
                          - Kasama
                          - Luwingu
                          - Chinsali
                          - Mpika
      operationId: get-vector-statistics
      description: This api it to calculate statistics for vector tiles from /0/0/0.pbf
      parameters:
        - schema:
            type: string
            example: 'https://pgtileserv.undpgeohub.org/zambia.poverty/0/0/0.pbf'
          in: query
          name: path
          description: URL for vector tile. must be /0/0/0.pbf path
          required: true
        - schema:
            type: string
            example: zambia.poverty
          in: query
          name: layer_name
          description: layer name for vector tile
          required: true
      tags:
        - vector tile
  '/vector/{source}/metadata.json':
    get:
      summary: Vector tile metadata.json API
      responses: {}
      operationId: 'get-vector-[source]-metadata.json'
      description: |-
        This api is to generate metadata.json for vector tiles.

        return metadata.json v1.3.0 (https://github.com/mapbox/mbtiles-spec/blob/master/1.3/spec.md)
      parameters:
        - schema:
            type: string
            example: zambia.poverty
          in: query
          name: table
          description: table name. only available for source = pgtileserv
        - schema:
            type: string
            enum:
              - table
              - function
          in: query
          name: type
          description: type name. only available for source = pgtileserv
        - schema:
            type: string
          in: query
          name: pbfpath
          description: pbf path. only available for soruce = azstorage
      tags:
        - vector tile
    parameters:
      - schema:
          type: string
          enum:
            - azstorage
            - pgtileserv
        name: source
        in: path
        required: true
        description: source type
  '/vector/{source}/tile.json':
    parameters:
      - schema:
          type: string
          enum:
            - pgtileserv
        name: source
        in: path
        required: true
        description: source type
    get:
      summary: Vector tile tile.json API
      responses: {}
      operationId: get-vector-source-tile.json
      description: |-
        This api is to generate tile.json for vector tiles.

        return TileJSON v3.0.0 (https://github.com/mapbox/tilejson-spec/tree/master/3.0.0)
      parameters:
        - schema:
            type: string
            example: zambia.poverty
          in: query
          name: table
          description: table name. only available for source = pgtileserv
          required: true
        - schema:
            type: string
            enum:
              - table
              - function
          in: query
          name: type
          description: type name. only available for source = pgtileserv
      tags:
        - vector tile
  /settings:
    get:
      summary: GeoHub User Settings
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                properties:
                  classification_method:
                    $ref: '#/components/schemas/ClassificationMethodTypes'
                  raster_resampling_method:
                    $ref: '#/components/schemas/ResamplingMethodTypes'
                  layer_opacity:
                    type: number
                  overlap_priority:
                    $ref: '#/components/schemas/OverlapPriority'
                  icon_size:
                    type: number
                  icon_image:
                    type: string
                  line_pattern:
                    $ref: '#/components/schemas/LinePattern'
                  font_size:
                    type: number
                  halo_width:
                    type: number
                  search_limit:
                    type: number
                  dataset_search_limit:
                    type: number
                  dataset_search_query_operator:
                    $ref: '#/components/schemas/QueryOperator'
                  dataset_sorting_column:
                    type: string
                  datapage_sorting_column:
                    type: string
                  tag_search_operator:
                    $ref: '#/components/schemas/TagSearchOperator'
                  map_page_sorting_column:
                    type: string
                  line_width:
                    type: number
                  number_of_classes:
                    type: number
                  sidebar_position:
                    $ref: '#/components/schemas/SidebarPosition'
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - GeoHub User Settings
    post:
      summary: Update GeoHub User Settings
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  classification_method:
                    $ref: '#/components/schemas/ClassificationMethodTypes'
                  raster_resampling_method:
                    $ref: '#/components/schemas/ResamplingMethodTypes'
                  layer_opacity:
                    type: number
                  overlap_priority:
                    $ref: '#/components/schemas/OverlapPriority'
                  icon_size:
                    type: number
                  icon_image:
                    type: string
                  line_pattern:
                    $ref: '#/components/schemas/LinePattern'
                  font_size:
                    type: number
                  halo_width:
                    type: number
                  search_limit:
                    type: number
                  dataset_search_limit:
                    type: number
                  dataset_search_query_operator:
                    $ref: '#/components/schemas/QueryOperator'
                  dataset_sorting_column:
                    type: string
                  datapage_sorting_column:
                    type: string
                  tag_search_operator:
                    $ref: '#/components/schemas/TagSearchOperator'
                  map_page_sorting_column:
                    type: string
                  line_width:
                    type: number
                  number_of_classes:
                    type: number
                  sidebar_position:
                    $ref: '#/components/schemas/SidebarPosition'
      security:
        - Azure AD authentication: []
        - API access token: []
      description: Update GeoHub User Settings
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                classification_method:
                  $ref: '#/components/schemas/ClassificationMethodTypes'
                raster_resampling_method:
                  $ref: '#/components/schemas/ResamplingMethodTypes'
                layer_opacity:
                  type: number
                overlap_priority:
                  $ref: '#/components/schemas/OverlapPriority'
                icon_size:
                  type: number
                icon_image:
                  type: string
                line_pattern:
                  $ref: '#/components/schemas/LinePattern'
                font_size:
                  type: number
                halo_width:
                  type: number
                search_limit:
                  type: number
                dataset_search_limit:
                  type: number
                dataset_search_query_operator:
                  $ref: '#/components/schemas/QueryOperator'
                dataset_sorting_column:
                  type: string
                datapage_sorting_column:
                  type: string
                tag_search_operator:
                  $ref: '#/components/schemas/TagSearchOperator'
                map_page_sorting_column:
                  type: string
                line_width:
                  type: number
                number_of_classes:
                  type: number
                sidebar_position:
                  $ref: '#/components/schemas/SidebarPosition'
        description: Update GeoHub User Settings
        required: true
      tags:
        - GeoHub User Settings
  /swagger/spec.json:
    get:
      summary: Get open API JSON definition
      responses: {}
      operationId: get-swagger-spec.json
      description: Get open API JSON definition
      tags:
        - swagger
  /continents:
    get:
      summary: Get continents
      tags:
        - admin
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    continent_code:
                      type: number
                    continent_name:
                      type: string
                  required:
                    - continent_code
                    - continent_name
              examples:
                Example 1:
                  value:
                    - continent_code: 2
                      continent_name: Africa
                    - continent_code: 19
                      continent_name: Americas
                    - continent_code: 0
                      continent_name: Antarctica
                    - continent_code: 142
                      continent_name: Asia
                    - continent_code: 150
                      continent_name: Europe
                    - continent_code: 9
                      continent_name: Oceania
      operationId: get-continents
      description: Get continents data from database
      parameters:
        - schema:
            type: boolean
            default: 'false'
          in: query
          name: filterbytag
          description: 'If true, only returns regions which exist in tag table'
  /regions:
    get:
      summary: Get regions
      tags:
        - admin
      responses: {}
      operationId: get-regions
      description: get regions data from database
      parameters:
        - schema:
            type: number
          in: query
          name: continent
          description: continent_code
        - schema:
            type: boolean
            default: 'false'
          in: query
          name: filterbytag
          description: 'If true, only returns regions which exist in tag table'
  /countries:
    get:
      summary: Get countries
      tags:
        - admin
      responses: {}
      operationId: get-countries
      description: get countries data from database
      parameters:
        - schema:
            type: string
          in: query
          name: continent
          description: continent code to filter
        - schema:
            type: string
          in: query
          name: region
          description: region code to filter
        - schema:
            type: boolean
            default: 'false'
          in: query
          name: filterbytag
          description: 'If true, only returns regions which exist in tag table'
  /menu:
    get:
      summary: Get menu items for data searching navigation
      tags:
        - menu
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    x-stoplight:
                      id: 5a16x4lay99wc
                    items:
                      x-stoplight:
                        id: 6u7zsyyuv7sjs
                      type: object
                      properties:
                        name:
                          type: string
                          x-stoplight:
                            id: 7fvs2ayvf2df8
                        icon:
                          type: string
                          x-stoplight:
                            id: ed6j9udfpnppd
                        url:
                          type: string
                          x-stoplight:
                            id: 2irxui12n8nk2
              examples:
                Example Home:
                  value:
                    items:
                      - name: SDG
                        icon: /assets/sdgs/SDG Wheel_WEB.png
                        url: /api/tags?key=sdg_goal
                      - name: Continent
                        icon: fa-solid fa-globe
                        url: /api/continents?filterbytag=true
                      - name: UNDP
                        icon: /assets/undp-images/undp-logo-blue.svg
                        url: /api/datasets?provider=undp
                      - name: UNICEF
                        icon: /assets/unicef.png
                        url: /api/datasets?provider=unicef
                      - name: UNEP
                        icon: /assets/unep.png
                        url: /api/datasets?provider=unep
                      - name: FAO
                        icon: /assets/fao.svg
                        url: /api/datasets?provider=fao
                      - name: Satellite imagery
                        icon: fa-solid fa-satellite
                        url: /api/datasets?type=stac
                      - name: Dynamic vector data
                        icon: /assets/postgresql.png
                        url: /api/datasets?type=pgtileserv
                      - name: Favourite
                        icon: /assets/star.png
                        url: /api/datasets?staronly=true
                      - name: My data
                        icon: fa-solid fa-circle-user
                        url: /api/datasets?mydata=true
      operationId: get-menu
      description: Get menu items for data tab at maps page according to the current breadcrumbs setting. The reponse maybe will be different if users do not sign in.
      parameters:
        - schema:
            type: string
            example: 'Home,SDG'
          in: query
          name: breadcrumbs
          description: 'current breadcrumbs setting. It should be specified by using comma for multiple breadcrumbs name. For example, ''Home'', ''Home,SDG'' etc.'
          required: true
  /users:
    get:
      summary: Search registered users
      tags:
        - users
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  x-stoplight:
                    id: d4sv1m7k0ix1s
                  type: object
                  properties:
                    id:
                      type: string
                      x-stoplight:
                        id: v42pppiux8nf7
                    user_email:
                      type: string
                      x-stoplight:
                        id: ueqlx52d14wo0
                  required:
                    - id
                    - user_email
      operationId: get-users
      description: Search registered users by email address
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: string
          in: query
          name: query
          description: Email address to search
          required: true
        - schema:
            type: number
            default: '10'
          in: query
          name: limit
          description: search limit. Default is 10
  /token:
    get:
      summary: Generate an access token for API
      responses: {}
      operationId: get-token
      description: |
        Generate an access token for GeoHub APIs. The permission of a token issued will follow the user's permission who issues. This token is only valid within `/api` endpoints. Pages have to be authenticated with SSO through authentication providers.

        Only approved users can specify expiration time with `duration` query param. Otherwise, a token will be expired in an hour as default.

        Regarding to the format of expiration time, please follow the below formats.

        Format used for time span should be a number followed by a unit, such as `5 minutes` or `1 day`.

        Valid units are: 
        - `sec`, `secs`, `second`, `seconds`, `s`
        - `minute`, `minutes`, `min`, `mins`, `m`, 
        - `hour`, `hours`, `hr`, `hrs`, `h`, 
        - `day`, `days`, `d`, 
        - `week`, `weeks`, `w`, 
        - `year`, `years`, `yr`, `yrs`, `y`. 

        It is not possible to specify months. 365.25 days is used as an alias for a year.
      security:
        - Azure AD authentication: []
        - API access token: []
      parameters:
        - schema:
            type: string
          in: query
          name: duration
          description: 'The duration, that the token will be valid. Only valid for approved users.'
      tags:
        - token
  '/mapstyle/{id}.json':
    parameters:
      - schema:
          type: string
          enum:
            - style
            - dark
            - aerialstyle
            - positron
        name: id
        in: path
        required: true
        description: basemap id
    get:
      summary: Get Maplibre Basemap Style
      tags:
        - BaseMap Style
      responses:
        '200':
          description: OK. returns maplibre style.json
          content: {}
      operationId: get-mapstyle-id-.json
      description: |-
        Get Maplibre style.json for basemap.

        The style files are hosted by the following structure

        - /mapstyle/style.json
        - /mapstyle/dark.json
        - /mapstyle/positron.json
        - /mapstyle/aerialstyle.json
        - /mapstyle/sprite/sprite
        - /mapstyle/sprite-non-sdf/sprite

        Maplibre Stylefiles are managed at https://github.com/UNDP-Data/style
      parameters: []
  '/mapstyle/sprite/sprite{ratio}.{format}':
    parameters:
      - schema:
          type: string
          enum:
            - json
            - png
        name: format
        in: path
        required: true
      - schema:
          type: string
          default: '""'
          enum:
            - \@2x
            - \@4x
        name: ratio
        in: path
  /products:
    get:
      summary: Get a list of all available products
      tags:
        - products
      responses: {}
      operationId: get-list-of-products
      description: Get a list of products available for a collection
    post:
      summary: Register a new product
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                  example: ndvi
                  description: Product ID. This is a unique identifier for each product
                label:
                  type: string
                  example: ndvi
                  description: Label.
                expression:
                  type: string
                  example: '({asset1}-{asset2})/({asset1}+{asset2})'
                  description: Mathematical expression to calculate the product based on the assets
                description:
                  type: string
                  example: Normalized Difference Vegetation Index
                  description: Description of the product
              required:
                - product_id
                - label
                - expression
                - description
      tags:
        - products
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  expression:
                    type: string
                  label:
                    type: string
                  description:
                    type: string
      description: Register a new product
      security:
        - Azure AD authentication: []
        - API access token: []
  '/products/{id}':
    parameters:
      - schema:
          type: string
        name: id
        in: path
        required: true
        description: Product ID
    get:
      summary: Get a specific product
      tags:
        - products
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
              examples:
                Example:
                  value:
                    id: ndvi
                    description: Normalized Difference Vegetation Index
                    expression: '({asset1}-{asset2})/({asset1}+{asset2})'
                    label: ndvi
        '404':
          description: Not Found
      operationId: get-single-product
      description: Get a list of products available for a collection
    put:
      summary: Update a product
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Product'
            examples:
              Example:
                value:
                  id: ndvi
                  description: Normalized Difference Vegetation Index
                  expression: '({asset1}-{asset2})/({asset1}+{asset2})'
                  label: ndvi
      tags:
        - products
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'
        '403':
          description: Forbidden
        '404':
          description: Not Found
      description: Update a product
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete a product
      tags:
        - products
      responses:
        '204':
          description: No Content
        '403':
          description: Forbidden
        '404':
          description: Not Found
      description: Delete a product
      security:
        - Azure AD authentication: []
        - API access token: []
  '/stac/{id}/{collection}/products':
    get:
      summary: Get a list of products registered to a specific Stac Dataset
      tags:
        - products
      parameters:
        - schema:
            type: string
            enum:
              - microsoft-pc
              - earth-search
          name: id
          in: path
          required: true
          description: Stac ID
        - schema:
            type: string
            example: sentinel-2-l2a
          name: collection
          in: path
          required: true
          description: Collection ID
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StacProduct'
  '/stac/{id}/{collection}/products/{product_id}':
    parameters:
      - in: path
        name: id
        required: true
        description: Stac ID
        schema:
          type: string
          enum:
            - microsoft-pc
            - earth-search
      - in: path
        name: collection
        required: true
        description: Collection ID
        schema:
          type: string
          example: sentinel-2-l2a
      - in: path
        name: product_id
        required: true
        description: Product ID
        schema:
          type: string
    get:
      summary: Get a Stac Collection product
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StacProduct'
      tags:
        - products
    post:
      summary: Create new stac collection product
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                assets:
                  type: array
                  example:
                    - nir
                    - red
                  description: Assets that make up this product.
                description:
                  type: string
                  example: Normalized Difference Vegetation Index
              required:
                - assets
      tags:
        - products
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Product registered
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete a Stac Collection product
      tags:
        - products
      responses:
        '200':
          description: OK
      description: Delete a product
      parameters:
        - name: id
          in: path
          required: true
          description: Stac ID
          schema:
            type: string
            enum:
              - microsoft-pc
              - earth-search
        - name: collection
          in: path
          required: true
          description: collection id
          schema:
            type: string
            example: sentinel-2-l2a
        - name: product_id
          in: path
          required: true
          description: product id
          schema:
            type: string
            example: ndvi
      security:
        - Azure AD authentication: []
        - API access token: []
  /storymaps:
    get:
      summary: Search storymaps
      tags:
        - storymap
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  storymaps:
                    type: array
                    items:
                      $ref: '#/components/schemas/StoryMap'
                  links:
                    type: array
                    items:
                      type: object
                      properties:
                        rel:
                          type: string
                        type:
                          type: string
                        href:
                          type: string
                  pages:
                    type: object
                    properties:
                      totalCount:
                        type: integer
                      totalPages:
                        type: integer
                      currentPage:
                        type: integer
      operationId: get-storymaps
      description: 'Search storymaps with user specified conditions such as query text, access level, etc.'
      security:
        - Azure AD authentication: []
        - API access token: []
      x-internal: false
      parameters:
        - schema:
            type: string
          in: query
          name: query
          description: 'free text to search in title, description in storymap header and chapters'
        - schema:
            type: number
          in: query
          name: limit
          description: The number of datasets retrieved. default is 10
        - schema:
            type: string
            example: 'title,desc'
          in: query
          name: sortby
          description: 'sorting column (title, createdat, updateat or no_stars) and sorting order. e.g., ''updatedat, desc''. if asc or desc is skipped, asc will be used.'
        - schema:
            type: number
          in: query
          name: offset
          description: Offset value for paging. default is 0
        - schema:
            type: integer
            default: 1
            enum:
              - 1
              - 2
              - 3
          in: query
          name: accesslevel
          description: 'ccess Level published to 1: login user 2: UNDP 3: public'
        - schema:
            type: boolean
          in: query
          name: staronly
          description: 'if true, only search for favourite datasets'
    post:
      summary: Register new storymap
      operationId: post-storymaps
      responses:
        '200':
          description: OK
        '400':
          description: Bad Request
        '403':
          description: Forbidden
      description: 'Resiter new storymap object. If uuid is not specified, it will generate new uuid to register. If uuid is specified, check the database whether the ID already exists, update if passed checking user permission.'
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - storymap
      requestBody:
        content:
          application/json:
            schema:
              $ref: ../../../build/client/api/swagger/spec.yaml#/components/schemas/StoryMap
            examples:
              Example 1:
                value:
                  id: 33c0d688-e742-4e0b-b118-fae8d524b168
                  base_style_id: dark
                  template_id: light
                  title: Maplibre story map demo
                  subtitle: Subtitle of storymap
                  byline: Jin Igarashi
                  footer: United Nations Development Programme
                  access_level: 3
                  chapters:
                    - id: 439eeb54-76b0-4f7f-8887-abae8fac0a28
                      title: Kenya
                      description: This is Kenya
                      image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAABWCAYAAAAHWZ75AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH6AYOFjosVobchAAACSpJREFUeNrtnXtMVFcexz8zDE95iPISfNKuRdaiWB8x65soVFzTtWtKVrcmbUXNbnyAinF9FI1sKaul65q21AQ21myztb5iXK1NV7vbbBvUupXCKq5oLYrgDgIDDHKZs38wDMPMnRHTpN65nm8yyT2/+7vncO79eM/vnvs7VwMgkHpiZZSnQAIgJQGQkgBISQCkJABSEgApCYCUBEBKAiAlAZCSAGhUJpNJ/i1PMgDh4eFs3rz5sf8dubm5hIWF+fRdQPjq78KFC2L79u2Prf28vDxRXl4ufPkc+jQARUVFQggh1q5d+6O3nZOTI4QQorCwUALwuH4zZswQQgihKIqYN2/ej9Zuenq6UBRFCCHEtGnTJACP62cwGER1dbUQQgiz2SxGjRrV72MzQRweM0YcSkoSzz9Cm4mJicJsNgshhLh69aowGAw+DYBPPwYKISgtLQUgMjKSsrIyjEbvXfIHtgEboqIYO38+KZmZbIqOZivwsFjeaDRSVlZGZGQkAKWlpQjh+wlVPk1wTEyMaG1tFT1as2aNR18TiB0gzoCozM4W1Xl5ojovT3z76qviDIhdIPy9tLV27VpHO62trSI6OtrXb//C5yeC6uvr2b9/v6O8Y8cOYmNjVX1/C0y1bw9OT3fYozIyAJgMrPLQTlxcHPn5+Y5ySUkJDQ0NciJICyooKKClpcUxP5CXl+fmkw5kOpUjJk/unVOYNMmx/XNgnkobmzZtIjw8HACLxUJhYaGcCdSK7t69y65duxzllStXEhMT4ygPAX7j5B8QF0fg0KGOctCIEQQ43TVWAwlO/rGxsaxYscJR3rlzJ3V1dRIALWn37t1cuHABgODgYGbPnu3oYB4Q7DyL+NxzbseHTZjg2A4EcgGDvTxnzhyCgoIAKC8vZ8+ePfJdgNakKApZWVncuHGjO9r39wf7bf+nLr7BTz3ldnxIYmKf8rNAhstcf01NDVlZWSiKohsATMuXL0dPysnJYeHChSxdupTAzk5+cewYWK19fIISEtyOcx4SHEFjUBAJCxfyyyVLKCsr4/jx46SlpZGWlqYfAEpKStCbTp8+TUpKCvV37hDocvEBTPbn+D62gQPdbAFWK9Pr6khNTUVRFA4fPqy7c6XLfID09HT+sn8/CV9/rd7p4GA3m19IiKrv0IsXOfjee2RmZurxVOk3IWTW/fvY7I+Gbp22xwd9bIGBqr42i4VpZrNeTxOm9uvXddepro4OLAcOeNxvUxkWutraPPq3HzyIJTsbPw+Q+DQAX6hExL6uvwMpwGBPgKhcbG8A1DU0UJiczEw5BPgOAF942f+gvt7N1qli69E54DOdDgG6A8ACnAfOevHpqK11s1m//94rAOVAqwRA+yoHOoEKoNmDT2tVVb9sAPeBSnud5yUA2lfPg58ALnnwabl4EeE0mycUhZZL6t6X6P2EyiUJgO8A4LrtGvA5/4u3VFRga29/aH0XJQDa1j3A+R1dhRffpi+/dGw3f/WVRz/nOm4DZgmAdlXjUr5lH7vV1HDsmGO7/uhRVZ9OoPYhbUgANKSbrrd6lQvYI/OZM3Q2NtJpNtP4mfpD3i17Hd7akABoSLdUbN958BWKgjEgAKO/f5+A8GH13dIZACY9daa5nzaAxPx8Rm3ZAnRnCP1327YfVJ+8A2hAapO5apM3BqORYatXO8rDVq/GoJJO3trP+iQAGgZAzRYQG4vJnuAJYIqIwN8ph7BH7RIA31KAik3t/V1nYyPCZuuNB7q6UBob+1VfkARAuxqgYgtVsdmsVv538mTv/MHJk9g6OvpV3wAZBPoWAJ4uWFV2NmPsC0qqsrN/cH0SAA0orp82gI47d6h9912EEDzwkOP/KPVJADSgkSq2ER58w8aPZ0ByMgDWmzexXL7s5jOqn23IGEAjcr3Y0R5iAICYRYt6t198UdUnFBgkAfAdDXMZo0d78R04szfBK3LGDI9+SS5AJEgAtCs/ulf09GiCBz+D0Uh4aqqjHD5xoupEEMB4p+1x6O/9ue7yAZwveqqnp4XkZPycvuzlFxZGyDPPqPqm9qM+CYCGNMkpWh/mwSc0JcXdNm6cx7gi1qVuCYCGNRR4GpjlxSdo+HB32zB1XAzATOAnQLwOATDpsE/MAiZ62R84ZIi7LT7ea30R6FOmp994Q3edWtXURGNRkcf3/H6hof2yOZ4mTCambNjAoAj9YWAaqfI5FV/XSODfNTU0fPih+rj3CItDAaIWL2ZcQYEu7wC6XRx6LiHB46Odqjx97s1g4B/x8Xo9TfoEoLa2limLF9MydqzqfrUUcE9rAy0pKUx56SVu3rypSwBMn1Z9qrtOnf3rWV5b9hqXs54n9NsK6LL12a+oLBvvslhUggUj5iWZPDtoEO//+X1mLZ6lPwDmFs/VVYeC7wVTuaeSnN/ncEQcYc1oWOCy6uvBnTtux3Xcvu1mO55kY++1AhYV/YfiLcUkrUmiLapNDgGalYANUzZw/cZ1jrQeAaB0Etx3ifms37nnCltv9c33NYdAqf1Z8nDbYaquVpE7OVd3/9W2rgBIuJtA7spc1v1pHdiD+uYg2OPyrkdtHWCLy+dk9v4MLD35ZMGwbu861q9az/D64RIATaoT3vz1mxz46ADfRHzTZ9e/RsAnTq8G265cQWnuTfBWmppov3bNUf5kNPzTJRmgMqqSDz76gIJfFcADCYDmNLV9KhlzMnj9xOvdrwVd9PZ0qI6yjxQ2Gy0Xe5d6Np8/70gSvT4Y/jhN/UxtPb6VjLQMpndOlwBoqhMtRopzi8l/K597MfdUfR74wY65cM+eMNB47pxj3/3PPwegYQBsS4cODxPk5jgzO9/eSfH6YoxNRgmAVrQsbhlhoWG8c+Udr351YbAxszvAq//4Y4f97qFDmENg4wK4G+q9rX1X9xEQEMDL8S/rAgAD2b4d14Y1hHFl3xVe+d0rnPI/1a9jBrXBxrOQnjIfIQSnKv7GH2Z2g9EfpVnTOPjmQUavGk1zdLME4LFOZDSZWBCygKNdRx951UbifSMCqBloe7QDrfCC3wucaDuBEqFIAKRkDCAlAZCSAEhJAKQkAFISACkJgJQEQEoCICUBkJIASEkApCQAUhIAKQmAlKZkyp6e/ZY8DU+u/g9L3DiLSVyBQQAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNC0wNi0xNFQyMjo1ODo0NCswMDowMA3BzpwAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjQtMDYtMTRUMjI6NTg6NDQrMDA6MDB8nHYgAAAAAElFTkSuQmCC'
                      imageAlignment: right
                      alignment: left
                      hidden: false
                      mapInteractive: false
                      mapNavigationPosition: top-right
                      location:
                        center:
                          - 35.446
                          - -0.12
                        zoom: 6
                        pitch: 0
                        bearing: 0
                      mapAnimation: flyTo
                      rotateAnimation: false
                      spinGlobe: false
                    - id: 90f04eff-88ab-49a4-b280-12b551b00fd7
                      title: Rwanda DEM
                      description: This is Rwanda DEM
                      alignment: right
                      hidden: false
                      mapInteractive: true
                      mapNavigationPosition: top-right
                      location:
                        center:
                          - 29.601
                          - -1.784
                        zoom: 8
                        pitch: 0
                        bearing: 0
                      mapAnimation: flyTo
                      rotateAnimation: false
                      spinGlobe: false
                      style_id: '315'
                      onChapterEnter:
                        - layer: 2e7e25c7-f5db-43a2-b7ba-70af559b623c
                          opacity: 0
                          duration: 0
                        - layer: e4032157-10e9-4c4a-a69e-efcc5e50ca08
                          opacity: 0
                          duration: 0
        description: ''
  '/storymaps/{id}':
    parameters:
      - $ref: '#/components/parameters/storymap_id'
    get:
      summary: Get storymap object by ID
      tags:
        - storymap
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StoryMap'
        '403':
          description: Forbidden
        '404':
          description: Not Found
      operationId: get-storymaps-id
      description: Get a storymap object including all chapters setting in order by storymap ID
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete a storymap by ID
      operationId: delete-storymaps-id
      responses:
        '204':
          description: No Content
        '403':
          description: Forbidden
        '404':
          description: Not Found
      description: Delete a storymap object by storymap ID
      requestBody:
        content: {}
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - storymap
  '/storymaps/{id}/permission':
    parameters:
      - $ref: '#/components/parameters/storymap_id'
    get:
      summary: Get user permission info for a storymap
      tags:
        - storymap
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StorymapPermission'
      operationId: get-storymaps-id-permission
      description: Get permission info for a storymap
      security:
        - Azure AD authentication: []
        - API access token: []
    post:
      summary: Register user permission for a storymap
      operationId: post-storymaps-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StorymapPermission'
      description: |
        Register user permission for a storymap

        - only users with owner/write/read permission can register.
        - users with write permission cannot register owner permission to a user.
        - users with read permission can register read permission to a user.
      tags:
        - storymap
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorymapPermission'
        description: ''
      security:
        - Azure AD authentication: []
        - API access token: []
    put:
      summary: Update user permission for a storymap
      operationId: put-storymaps-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StorymapPermission'
      description: |-
        Update user permission for a storymap

        - signed user cannot update their own permission
        - only users with owner/write/read permission can update.
        - users with write permission cannot update owner permission to a user.
        - users with read permission cannot update owner/write permission to a user.
      security:
        - Azure AD authentication: []
        - API access token: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StorymapPermission'
      tags:
        - storymap
    delete:
      summary: Delete user permission for a storymap
      operationId: delete-storymaps-id-permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/StorymapPermission'
      description: |-
        Delete user permission for a storymap

        - cannot delete signed in user themselves
        - only users with owner/write/read permission can delete.
        - users with write permission cannot delete owner.
        - users with read permission cannot delete owner/write
        - if only a user is registered, cannot delete user. at least a user needs to be registered
      security:
        - Azure AD authentication: []
        - API access token: []
      tags:
        - storymap
      parameters:
        - schema:
            type: string
          in: query
          name: user_email
          description: user email address
          required: true
  '/storymaps/{id}/star':
    parameters:
      - $ref: '#/components/parameters/storymap_id'
    post:
      summary: Register storymap to favourite
      operationId: post-storymaps-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  storymap_id:
                    type: string
                  user_email:
                    type: string
                  savedat:
                    type: string
                  no_stars:
                    type: integer
                required:
                  - storymap_id
                  - user_email
                  - savedat
      description: |-
        Register storymap to favourite
        This API only can be used when user sign in.
      tags:
        - storymap
      security:
        - Azure AD authentication: []
        - API access token: []
    delete:
      summary: Delete star from storymap
      operationId: delete-storymaps-id-star
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  storymap_id:
                    type: string
                  no_stars:
                    type: integer
      description: |-
        Delete star from storymap
        This API only can be used when user sign in.
      tags:
        - storymap
      security:
        - Azure AD authentication: []
        - API access token: []
  '/storymaps/{id}/star/count':
    parameters:
      - $ref: '#/components/parameters/storymap_id'
    get:
      summary: get star count for a storymap
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  storymap_id:
                    type: string
                  no_stars:
                    type: integer
      operationId: get-storymaps-id-star-count
      description: get the number of stars for a storymap
      tags:
        - storymap
      security:
        - Azure AD authentication: []
        - API access token: []
components:
  schemas:
    Tag:
      title: Tag
      x-stoplight:
        id: um38sy7bphx89
      type: object
      properties:
        key:
          type: string
        value:
          type: string
        count:
          type: number
      required:
        - key
        - value
    QueryOperator:
      title: QueryOperator
      type: string
      enum:
        - and
        - or
    TagSearchOperator:
      title: TagSearchOperator
      type: string
      enum:
        - and
        - or
    SidebarPosition:
      title: SidebarPosition
      type: string
      enum:
        - left
        - right
    ClassificationMethodTypes:
      title: ClassificationMethodTypes
      type: string
      enum:
        - e
        - q
        - 'n'
        - l
    ResamplingMethodTypes:
      title: ResamplingMethodTypes
      type: string
      enum:
        - nearest
        - linear
    OverlapPriority:
      title: OverlapPriority
      type: string
      enum:
        - always
        - never
        - cooperative
    LinePattern:
      title: LinePattern
      type: string
      enum:
        - solid
        - dash
        - dash-dot
        - dot
    Link:
      title: Link
      x-stoplight:
        id: 758pae8gfhqq8
      type: object
      properties:
        rel:
          type: string
        type:
          type: string
        href:
          type: string
    GeoJSONFeature:
      type: object
      x-examples: {}
      description: GeoJSON feature object for GeoHub
      properties:
        type:
          type: string
        geometry:
          type: object
          properties:
            type:
              type: string
            coordinates:
              type: array
              items:
                type: number
        properties:
          type: object
          properties:
            id:
              type: string
            url:
              type: string
            name:
              type: string
            description:
              type: string
            is_raster:
              type: boolean
            license:
              type: string
            access_level:
              type: integer
            createdat:
              type: string
            created_user:
              type: string
            updatedat:
              type: string
            updated_user:
              type: string
            tags:
              type: array
              items:
                $ref: '#/components/schemas/Tag'
            no_stars:
              type: integer
            permission:
              type: integer
            is_star:
              type: boolean
            links:
              type: array
              items:
                $ref: '#/components/schemas/Link'
    GeoJSONFeatureCollection:
      type: object
      x-examples: {}
      description: GeoJSON FeatureCollection object for GeoHub
      properties:
        type:
          type: string
        features:
          type: array
          items:
            $ref: '#/components/schemas/GeoJSONFeature'
        links:
          type: array
          items:
            $ref: '#/components/schemas/Link'
        pages:
          type: object
          properties:
            totalCount:
              type: integer
            totalPages:
              type: integer
            currentPage:
              type: integer
    DatasetLayerStyle:
      title: DatasetLayerStyle
      x-stoplight:
        id: 3edd696171c73
      type: object
      description: Dataset style definition
      x-examples: {}
      properties:
        dataset_id:
          type: string
          description: dataset ID
        layer_id:
          type: string
        layer_type:
          type: string
          description: 'Layer type. fill, line, symbol, circle, heatmap, raster'
        source:
          type: object
          description: Maplibre source object
        style:
          type: object
          description: Maplibre layer style object
        colormap_name:
          type: string
          description: Colormap name if applicable
        classification_method:
          type: string
          description: Classification method if applicable
        classification_method_2:
          type: string
          x-stoplight:
            id: s5ozu37b48b7z
          description: 'classification method if there are two classification settings (icon size, line width) apart from color.'
        createdat:
          type: string
        created_user:
          type: string
        updatedat:
          type: string
        updated_user:
          type: string
      required:
        - dataset_id
        - layer_id
        - layer_type
        - source
        - style
        - createdat
        - created_user
    StacProduct:
      title: StacProduct
      type: object
      description: STAC product object
      properties:
        stac_id:
          type: string
          description: STAC ID
        collection_id:
          type: string
          description: STAC collection ID
        product_id:
          type: string
          description: STAC product ID
        assets:
          type: array
          items:
            type: string
          description: Assets used in the product
        label:
          type: string
          description: Label. Display name for the product
        expression:
          type: string
          description: Product Expression.
        description:
          type: string
          description: Product Description.
    stac:
      title: stac
      x-stoplight:
        id: 51hxmfzs5mtju
      type: object
      description: STAC API/Catalog object
      x-examples:
        API:
          id: microsoft-pc
          name: Microsoft Planetary Computer
          url: 'https://planetarycomputer.microsoft.com/api/stac/v1'
          type: api
        Catalog:
          id: maxar-opendata
          name: Maxar Open Data
          url: 'https://maxar-opendata.s3.amazonaws.com/events/catalog.json'
          type: catalog
          providers:
            - Maxar Technologies
      properties:
        id:
          type: string
          description: STAC ID
        name:
          type: string
          x-stoplight:
            id: v1jc6kp2gikli
          description: STAC name
        url:
          type: string
          x-stoplight:
            id: eyl8a37kvp6ga
          description: API URL or catalog.json URL
        type:
          type: string
          x-stoplight:
            id: uaal8dmp1wuao
          description: either 'api' or 'catalog'
        providers:
          type: array
          x-stoplight:
            id: ape451kvnptqq
          description: list of provider names
          items:
            x-stoplight:
              id: olhqv5auy83ir
            type: string
        createdat:
          type: string
          x-stoplight:
            id: 124oktg1ynf9h
        created_user:
          type: string
          x-stoplight:
            id: a1bmx85anum4o
        updatedat:
          type: string
          x-stoplight:
            id: 2dgcrqaraoc0k
        updated_user:
          type: string
          x-stoplight:
            id: hscqetpry1rqr
      required:
        - id
        - name
        - url
        - type
        - createdat
        - created_user
    DatasetPermission:
      title: DatasetPermission
      x-stoplight:
        id: tf5ucos0vyjya
      type: object
      description: dataset_permission object
      properties:
        dataset_id:
          type: string
          x-stoplight:
            id: mz668x3itjbvu
          description: Dataset ID
        user_email:
          type: string
          x-stoplight:
            id: 2izccegifhkpo
          description: user email address
        permission:
          type: integer
          x-stoplight:
            id: yh1r1srllglod
          description: 'Permission. 1: Read, 2: Read/Write, 3: Owner'
        createdat:
          type: string
          x-stoplight:
            id: 4fp196ywfwz0l
          description: created datetime
        updatedat:
          type: string
          x-stoplight:
            id: bu54y520xfxuw
          description: updated datetime
      required:
        - dataset_id
        - user_email
        - permission
    StorymapPermission:
      title: StorymapPermission
      x-stoplight:
        id: dzyhjvvbi0w0b
      type: object
      description: storymap_permission object
      properties:
        storymap_id:
          type: string
          x-stoplight:
            id: mz668x3itjbvu
          description: Dataset ID
        user_email:
          type: string
          x-stoplight:
            id: 2izccegifhkpo
          description: user email address
        permission:
          type: integer
          x-stoplight:
            id: yh1r1srllglod
          description: 'Permission. 1: Read, 2: Read/Write, 3: Owner'
        createdat:
          type: string
          x-stoplight:
            id: 4fp196ywfwz0l
          description: created datetime
        updatedat:
          type: string
          x-stoplight:
            id: bu54y520xfxuw
          description: updated datetime
      required:
        - storymap_id
        - user_email
        - permission
    StylePermission:
      title: StylePermission
      x-stoplight:
        id: kgp2trp23qwfj
      type: object
      description: style_permission object
      properties:
        style_id:
          type: string
          x-stoplight:
            id: mz668x3itjbvu
          description: Style ID
        user_email:
          type: string
          x-stoplight:
            id: 2izccegifhkpo
          description: user email address
        permission:
          type: integer
          x-stoplight:
            id: yh1r1srllglod
          description: 'Permission. 1: Read, 2: Read/Write, 3: Owner'
        createdat:
          type: string
          x-stoplight:
            id: 4fp196ywfwz0l
          description: created datetime
        updatedat:
          type: string
          x-stoplight:
            id: bu54y520xfxuw
          description: updated datetime
      required:
        - dataset_id
        - user_email
        - permission
    Product:
      title: Product
      x-stoplight:
        id: xpb0twb5mvd8o
      type: object
      description: Product interface
      properties:
        id:
          type: string
        description:
          type: string
          x-stoplight:
            id: 783mwdxu83ye8
        label:
          type: string
          x-stoplight:
            id: 2dufwshr42dzz
        expression:
          type: string
          x-stoplight:
            id: lo8t29fbjo5k6
    StoryMap:
      title: StoryMap
      x-stoplight:
        id: 3b9jdtwb85riu
      type: object
      description: |-
        Storymap object for storymap plugin

        The object should be compatible for the plugin interface (see [here](https://github.com/UNDP-Data/geohub/blob/develop/packages/svelte-maplibre-storymap/src/lib/interfaces/StoryMapConfig.ts)).

        `style_id`, `base_style_id` and `template_id`, which are not in plugin interface, are included here because these properties need to be stored in the database table.  `style` should be a completed style JSON URL by creating from either `style_id` or `base_style_id`.
      properties:
        id:
          type: string
          x-stoplight:
            id: 562n1dnj74167
        style:
          type: string
          x-stoplight:
            id: v24dmg00malf5
          description: completed style URL by creating either style_id of base_style_id
        style_id:
          type: string
          x-stoplight:
            id: col5imqs3uyr5
          description: Optional. Existing map ID
        base_style_id:
          type: string
          x-stoplight:
            id: vlnkqrtk4mw0y
          description: Optional. base map ID
        template_id:
          type: string
          x-stoplight:
            id: 8ucce252g6y25
          description: Template ID for storymap
        title:
          type: string
          x-stoplight:
            id: 8c79brp9bkzwi
        logo:
          type: string
          x-stoplight:
            id: 7y0ul2c9yqxw1
        subtitle:
          type: string
          x-stoplight:
            id: v3fz1ddetl4yf
        byline:
          type: string
          x-stoplight:
            id: krupr5tckulsl
        footer:
          type: string
          x-stoplight:
            id: v0d5xdht18p7e
        chapters:
          type: array
          x-stoplight:
            id: 1esf1d056evfr
          items:
            $ref: '#/components/schemas/StorymapChapter'
        access_level:
          type: integer
          x-stoplight:
            id: 3bzc6zvfr3k58
        createdat:
          type: string
          x-stoplight:
            id: jquro9n3qcqh4
        created_user:
          type: string
          x-stoplight:
            id: patk3jt9qxw1o
        updatedat:
          type: string
          x-stoplight:
            id: g8tubla9r7yqr
        updated_user:
          type: string
          x-stoplight:
            id: hq73drakuvrmm
        links:
          type: array
          x-stoplight:
            id: j3img0hjlmzrl
          items:
            $ref: '#/components/schemas/Link'
      required:
        - id
        - style
        - template_id
    StorymapChapter:
      title: StorymapChapter
      x-stoplight:
        id: kipmo7di7fafs
      type: object
      description: Storymap chapter interface
      properties:
        id:
          type: string
        title:
          type: string
          x-stoplight:
            id: 8skoc7kmcx8dm
        description:
          type: string
          x-stoplight:
            id: pyntwtudhqzcm
        image:
          type: string
          x-stoplight:
            id: n7qyblay0pghz
        imageAlignment:
          type: string
          x-stoplight:
            id: 7f1qrmj92lxp1
          enum:
            - left
            - center
            - right
          default: center
        alignment:
          type: string
          x-stoplight:
            id: ptzocb1kzco27
          enum:
            - center
            - left
            - right
            - full
          default: center
        hidden:
          type: boolean
          x-stoplight:
            id: qxkbmd7g5gfoi
          default: false
        mapInteractive:
          type: boolean
          x-stoplight:
            id: 9bultxas6zieq
          default: false
        mapNavigationPosition:
          type: string
          x-stoplight:
            id: d8295gsxloaw1
          enum:
            - top-right
            - top-left
            - bottom-left
            - bottom-right
          default: top-right
        location:
          type: object
          x-stoplight:
            id: rjex8j4upbrls
          required:
            - center
            - zoom
            - pitch
            - bearing
          properties:
            center:
              type: array
              x-stoplight:
                id: wvq95oiafp60x
              items:
                x-stoplight:
                  id: lfkih0xc8xgfu
                type: number
            zoom:
              type: number
              x-stoplight:
                id: zzak4ck0o24op
            pitch:
              type: number
              x-stoplight:
                id: jw1x667z4b5z8
            bearing:
              type: number
              x-stoplight:
                id: 2pmfl6rp9zkt7
        mapAnimation:
          type: string
          x-stoplight:
            id: o3tkjgx3zy0ex
          enum:
            - flyTo
            - easeTo
            - jumpTo
          default: flyTo
        rotateAnimation:
          type: boolean
          x-stoplight:
            id: 4nbx1pehytwwx
          default: false
        spinGlobe:
          type: boolean
          x-stoplight:
            id: m1kf8kxqc9mjb
          default: false
        style:
          type: string
          x-stoplight:
            id: x8b10wiezr54p
          description: completed style URL by creating either style_id of base_style_id
        style_id:
          type: string
          x-stoplight:
            id: 5d56k8nuwygr9
          description: Optional. Existing map ID
        base_style_id:
          type: string
          x-stoplight:
            id: pjl5pp7z6b9tt
          description: Optional. base map ID
        onChapterEnter:
          type: array
          x-stoplight:
            id: 3nerinvw0i6xf
          items:
            $ref: '#/components/schemas/StoryMapChapterLayerEvent'
        onChapterExit:
          type: array
          x-stoplight:
            id: 5kgx3hidr91rt
          items:
            $ref: '#/components/schemas/StoryMapChapterLayerEvent'
        createdat:
          type: string
          x-stoplight:
            id: ss0jzdjfyxe9w
        created_user:
          type: string
          x-stoplight:
            id: 4rfucgkbs5l6b
        updatedat:
          type: string
          x-stoplight:
            id: qoh09wxabhzin
        updated_user:
          type: string
          x-stoplight:
            id: xfscwcu0lg71w
      required:
        - id
        - title
        - alignment
        - hidden
        - mapInteractive
        - mapNavigationPosition
        - location
        - mapAnimation
        - rotateAnimation
        - spinGlobe
        - style
    StoryMapChapterLayerEvent:
      title: StoryMapChapterLayerEvent
      x-stoplight:
        id: 3guznt0g1fpd0
      type: object
      properties:
        layer:
          type: string
          x-stoplight:
            id: es23p5cfa5ahh
        opacity:
          type: number
          x-stoplight:
            id: djam6cnhxvgrq
        duration:
          type: integer
          x-stoplight:
            id: hm4yadkfpzy2y
      required:
        - layer
        - opacity
      description: Chapter layer event interface
  parameters:
    lon:
      name: lon
      in: path
      required: true
      schema:
        type: number
        default: 0
      description: longitude
    lat:
      name: lat
      in: path
      required: true
      schema:
        type: number
        default: 0
      description: latitude
    zoom:
      name: zoom
      in: path
      required: true
      schema:
        type: number
        default: 0
        minimum: 0
        maximum: 22
      description: zoom level
    width:
      name: width
      in: path
      required: true
      schema:
        type: integer
        default: 300
      description: image width (pixel)
    height:
      name: height
      in: path
      required: true
      schema:
        type: number
        default: 200
      description: image height (pixel)
    bbox:
      name: bbox
      in: path
      required: true
      schema:
        type: string
        example: '-4.04296875,-15.114552871944102,48.69140625,19.476950206488414'
      description: 'bbox (minx, miny, maxx, maxy)'
    bearing:
      name: bearing
      in: path
      required: true
      schema:
        type: number
        default: 0
      description: bearing
    pitch:
      name: pitch
      in: path
      required: true
      schema:
        type: number
        default: 0
      description: pitch
    format:
      name: format
      in: path
      required: true
      schema:
        type: string
        default: png
        enum:
          - png
          - jpeg
          - webp
      description: 'Supported format (jpeg, png, webp)'
    ratio:
      name: ratio
      in: query
      required: false
      schema:
        type: integer
        enum:
          - 1
          - 2
        default: 1
      description: ratio. either 1 or 2. Default is 1
    dataset_id:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Dataset ID
    maplibre_layer_type:
      name: type
      in: path
      required: true
      schema:
        type: string
        enum:
          - fill
          - line
          - symbol
          - circle
          - heatmap
          - fill-extrusion
          - raster
      description: 'Maplibre layer type (fill, line, symbol, circle, heatmap, raster)'
    maplibre_layer_id:
      name: layer
      in: path
      required: true
      schema:
        type: string
      description: 'Band name if it is raster, layer ID if it is vector.'
    maplibre_layer_id_optional:
      name: layer
      in: query
      required: false
      schema:
        type: string
      description: 'Band name if it is raster, layer ID if it is vector.'
    maplibre_layer_type_optional:
      name: type
      in: query
      required: false
      schema:
        type: string
        enum:
          - fill
          - line
          - symbol
          - circle
          - heatmap
          - fill-extrusion
          - raster
      description: 'Maplibre layer type (fill, line, symbol, circle, heatmap, raster)'
    storymap_id:
      name: id
      in: path
      required: true
      schema:
        type: string
      description: Storymap UUID
  securitySchemes:
    Azure AD authentication:
      type: http
      scheme: oauth
      description: Access to /auth/signin to sign in to Azure AD with your UNDP account.
    API access token:
      name: token
      type: apiKey
      in: query
  responses: {}
